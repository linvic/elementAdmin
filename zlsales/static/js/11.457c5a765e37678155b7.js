webpackJsonp([11],{NHwW:function(e,t){},S2lc:function(e,t){},dcEy:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={data:function(){return{form:{parentid:0,unit_name:"",unit_code:"",manager_id:"",unit_desc:""},userlists:[],form_rules:{unit_name:[{required:!0,message:"请输入组织名称",trigger:"blur"}],unit_code:[{required:!0,message:"请输入组织编号",trigger:"blur"}]},optionsValue:[],options:[],optionsProps:{value:"id",label:"text",children:"children"}}},props:{id:{type:Number}},created:function(){this.getDataTree()},methods:{remoteMethod:function(e){var t=this;""!==e&&this.$https.get("/api/Account/page_users_seach_user_account_name?currentPage=1&pageSize=10&keyword="+e).then(function(e){0==e.data.code?t.userlists=e.data.data.Items:t.$message({type:"error",showClose:!0,message:e.data.message})})},getDataTree:function(){var e=this;this.$https.get("/api/company_unit/GetUnitsTree").then(function(t){0==t.data.code?(e.options=t.data.data,e.id&&e.getOldData()):e.$message({type:"error",showClose:!0,message:t.data.message})})},getOldData:function(){var e=this;this.$https.get("/api/company_unit/GetCompanyUnitDetail?unit_id="+this.id).then(function(t){if(0==t.data.code){var a=t.data.data;if(e.form.parentid=0==a.parentid?"":a.parentid,e.optionsValue=e.getTreeDeepArr(e.form.parentid,e.options),e.form.unit_name=a.unit_name,e.form.manager_id=0==a.manager_id?"":a.manager_id,0==a.manager_id)e.form.manager_id="";else{var i={user_id:a.manager_id,user_name:a.manager_name};e.userlists.push(i),e.form.manager_id=a.manager_id}e.form.unit_code=a.unit_code,e.form.unit_desc=a.unit_desc}else e.$message({type:"error",showClose:!0,message:t.data.message})})},submit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return console.error("验证失败"),!1;var a={parentid:e.form.parentid&&""!=e.form.parentid?e.form.parentid:0,unit_name:e.form.unit_name,unit_code:e.form.unit_code,manager_id:e.form.manager_id&&""!=e.form.manager_id?e.form.manager_id:0,unit_desc:e.form.unit_desc};e.id?(a.unit_id=parseInt(e.id),e.$https.post("/api/company_unit/UpdateCompanyUnit",a).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"编辑成功",duration:1500,onClose:function(){e.closeDialog("dialogStructureEdit"),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})):e.$https.post("/api/company_unit/AppendCompanyUnit",a).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"添加成功",duration:1500,onClose:function(){e.closeDialog("dialogStructureAdd"),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})})},closeDialog:function(e){e?this.$emit("closeDialog",e):(this.$emit("closeDialog","dialogStructureAdd"),this.$emit("closeDialog","dialogStructureEdit"))},cascaderChange:function(e){console.log(e[e.length-1]),this.form.parentid=e[e.length-1]},getTreeDeepArr:function(e,t){var a=[],i=[],s=0;return function t(o,n){for(var r=0;r<o.length;r++){if(s=n,a[n]=o[r].id,o[r].id==e){i=a.slice(0,n+1);break}o[r].children&&(s++,t(o[r].children,s))}return i}(t,s)}}},s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"form",attrs:{"status-icon":"",rules:e.form_rules,model:e.form,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"父级："}},[a("el-cascader",{attrs:{options:e.options,props:e.optionsProps,"show-all-levels":!1,"change-on-select":"",clearable:""},on:{change:e.cascaderChange},model:{value:e.optionsValue,callback:function(t){e.optionsValue=t},expression:"optionsValue"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"组织名称：",prop:"unit_name"}},[a("el-input",{model:{value:e.form.unit_name,callback:function(t){e.$set(e.form,"unit_name",t)},expression:"form.unit_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"组织编号：",prop:"unit_code"}},[a("el-input",{model:{value:e.form.unit_code,callback:function(t){e.$set(e.form,"unit_code",t)},expression:"form.unit_code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"负责人："}},[a("el-select",{attrs:{filterable:"",remote:"",clearable:"","remote-method":e.remoteMethod,placeholder:"输入关键词检索"},model:{value:e.form.manager_id,callback:function(t){e.$set(e.form,"manager_id",t)},expression:"form.manager_id"}},e._l(e.userlists,function(e){return a("el-option",{key:e.user_id,attrs:{label:e.user_name,value:e.user_id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"备注："}},[a("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.form.unit_desc,callback:function(t){e.$set(e.form,"unit_desc",t)},expression:"form.unit_desc"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:function(t){e.closeDialog()}}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var o={components:{StructureAdd:a("Aizv")(i,s,!1,function(e){a("NHwW")},"data-v-5914e736",null).exports},data:function(){return{editId:null,treeData:[],defaultProps:{children:"children",label:"label",code:"code"},dialogStructureAdd:!1,dialogStructureEdit:!1}},created:function(){this.getDataList()},methods:{getDataList:function(){var e=this;this.$https.get("/api/company_unit/GetUnitsTree").then(function(t){0==t.data.code?e.treeData=t.data.data:e.$message({type:"error",showClose:!0,message:t.data.message})})},itemEdit:function(e){this.editId=Number(e),this.dialogStructureEdit=!0},itemDel:function(e){var t=this;this.$https.post("/api/company_unit/DeleteCompanyUnit?unit_id="+e).then(function(e){0==e.data.code?t.$message({type:"success",showClose:!0,message:"删除成功",duration:1500,onClose:function(){t.getDataList()}}):t.$message({type:"error",showClose:!0,message:e.data.message})})},closeDialog:function(e){this[e]=!1}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dictype"},[a("el-card",{staticStyle:{"min-width":"800px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("组织架构")]),e._v(" "),a("el-button-group",{staticStyle:{float:"right"}},[a("el-button",{attrs:{icon:"el-icon-refresh",size:"mini",plain:"",onclick:"window.location.reload()"}},[e._v("刷新")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline",size:"mini"},on:{click:function(t){e.dialogStructureAdd=!0}}},[e._v("新增")])],1)],1),e._v(" "),a("table",{staticClass:"el-table el-table__header",attrs:{cellspacing:"0",cellpadding:"0",border:"0",width:"100%"}},[a("thead",{staticClass:"has-gutter"},[a("tr",[a("th",{staticClass:"cell"},[e._v("组织名称")]),e._v(" "),a("th",{attrs:{width:"200px"}},[e._v("负责人")]),e._v(" "),a("th",{attrs:{width:"200px"}},[e._v("操作")])])])]),e._v(" "),a("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{data:e.treeData,props:e.defaultProps,"default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var i=t.data;return a("div",{staticClass:"custom-tree-node"},[a("div",[e._v(e._s(i.text))]),e._v(" "),a("div",[a("div",{staticClass:"custom-tree-node-item",staticStyle:{width:"200px"}},[e._v(e._s(i.attrValue||" "))]),e._v(" "),a("div",{staticClass:"custom-tree-node-item",staticStyle:{width:"200px"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.itemEdit(i.id)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){e.itemDel(i.id)}}},[e._v("删除")])],1)])])}}])})],1),e._v(" "),e.dialogStructureAdd?a("el-dialog",{attrs:{title:"新增组织",visible:e.dialogStructureAdd,"append-to-body":"",width:"600px"},on:{"update:visible":function(t){e.dialogStructureAdd=t}}},[a("StructureAdd",{on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogStructureEdit?a("el-dialog",{attrs:{title:"编辑组织",visible:e.dialogStructureEdit,"append-to-body":"",width:"600px"},on:{"update:visible":function(t){e.dialogStructureEdit=t}}},[a("StructureAdd",{attrs:{id:e.editId},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e()],1)},staticRenderFns:[]};var r=a("Aizv")(o,n,!1,function(e){a("S2lc")},"data-v-765e5dcc",null);t.default=r.exports}});
//# sourceMappingURL=11.457c5a765e37678155b7.js.map