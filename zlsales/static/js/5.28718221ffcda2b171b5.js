webpackJsonp([5],{Fz0F:function(e,t){},JsVN:function(e,t){},Sll4:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("u6qr"),o=a.n(i),n=a("3SZ7"),s=a.n(n),r=a("BGwB"),l={components:{ContactsAdd:r.a},data:function(){var e=this;return{form:{theme:"",classification:[],customer_source:"",purchase_intention:"",customer_name:"",telephone:"",enterprise_name:"",job:"",intentional_area:"",company_email:"",communication_address:""},form_rules:{theme:[{required:!0,message:"线索主题不能为空",trigger:"blur"}],classification:[{type:"array",required:!0,message:"请至少选择一个分类",trigger:"change"}],customer_source:[{required:!0,message:"请选择线索来源",trigger:"change"}],purchase_intention:[{required:!0,message:"请选择购买意向",trigger:"change"}],customer_name:[{required:!0,message:"客户姓名不能为空",trigger:"blur"}],telephone:[{required:!0,message:"联系电话不能为空",trigger:"blur"},{validator:function(t,a,i){!e.id&&a?e.$https.get("/api/Customer/get_model_by_telephone?telephone="+e.form.telephone).then(function(t){if(0==t.data.code){i(new Error("联系号码已存在"));var a=t.data.data.c_id,o=t.data.data.user_id;e.$confirm("联系号码已存在"+(t.data.data.user_name?", 此客户现归属于业务员（"+t.data.data.user_name+"）":"")+"，您可申请仲裁","提示",{confirmButtonText:"申请仲裁",cancelButtonText:"取消",type:"warning"}).then(function(){var t=[{c_id:a,old_user_id:o,apply_remark:"线索新增时申请仲裁"}];e.$https.post("/api/customer_change_salesman/create_customer_change_salesman",t).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"申请成功",duration:1500,onClose:function(){e.closeDialog(),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})}).catch(function(){})}else i()}):i()},trigger:"blur"}]},dialogContactsAdd:!1,ContactsList:[],classification:[],customer_source:[],purchase_intention:[]}},props:{id:{type:Number}},created:function(){var e=this;this.$https.all([this.getDic("crm_classification","classification"),this.getDic("crm_customer_source","customer_source"),this.getDic("crm_purchase_intention","purchase_intention")]).then(this.$https.spread(function(t,a){e.id&&(e.getOldData(),e.getContactsList())}))},watch:{},methods:{setContactsList:function(e){var t=this,a=JSON.parse(e);this.id?(a.c_id=this.id,this.$https.post("/api/customer_linkman/create_customer_linkman",a).then(function(e){0==e.data.code?t.getContactsList():t.$message({type:"error",showClose:!0,message:e.data.message})})):this.ContactsList.push(a)},closeTag:function(e,t){var a=this;this.id?this.$https.get("/api/customer_linkman/delete_customer_linkman?cl_id="+e.cl_id+"&c_id="+this.id).then(function(e){0==e.data.code?a.$message({type:"success",showClose:!0,message:"联系人删除成功",duration:1e3,onClose:function(){a.getContactsList()}}):a.$message({type:"error",showClose:!0,message:e.data.message})}):this.ContactsList.splice(t,1)},closeThisDialog:function(e){this[e]=!1},getOldData:function(){var e=this;this.$https.get("/api/Customer/get_customerdetails?c_id="+this.id).then(function(t){if(0==t.data.code){var a=t.data.data;e.form.theme=a.theme,e.form.classification=a.classification.split(","),e.form.customer_source=a.customer_source,e.form.purchase_intention=a.purchase_intention,e.form.customer_name=a.customer_name,e.form.telephone=a.telephone,e.form.enterprise_name=a.enterprise_name,e.form.job=a.job,e.form.intentional_area=0==a.intentional_area?"":a.intentional_area,e.form.company_email=a.company_email,e.form.communication_address=a.communication_address,console.log(e.form)}else e.$message({type:"error",showClose:!0,message:t.data.message})})},getContactsList:function(){var e=this;this.$https.get("/api/customer_linkman/list_customer_linkman?c_id="+this.id).then(function(t){0==t.data.code?e.ContactsList=t.data.data:e.$message({type:"error",showClose:!0,message:t.data.message})})},existCompany:function(){var e=this;this.$https.get("/api/Customer/exist_by_enterprise_name?enterprise_name="+this.form.enterprise_name).then(function(t){0==t.data.code&&e.$alert("此公司名称已存在，如有需要可向总监申请仲裁","提醒",{confirmButtonText:"知道了"})})},submit:function(){var e=this;console.log("提交"),this.$refs.form.validate(function(t){if(!t)return console.error("验证失败"),!1;var a=JSON.parse(s()(e.form));a.classification=e.form.classification.join(","),a.intentional_area=""==e.form.intentional_area?0:e.form.intentional_area,e.id?(a.c_id=parseInt(e.id),e.$https.post("/api/Customer/update_customer_clue",a).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"编辑成功",duration:1500,onClose:function(){e.closeDialog("dialogCluesEdit"),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})):(a.list_customer_linkman=e.ContactsList,e.$https.post("/api/Customer/create_customer_clue",a).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"添加成功",duration:1500,onClose:function(){e.closeDialog("dialogCluesAdd"),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})}))})},getDic:function(e,t){var a=this;this.$https.get("/api/Dicts/GetValues",{params:{type_code:e}}).then(function(e){0==e.data.code?a[t]=e.data.data:a.$message({type:"error",showClose:!0,message:e.data.message})})},closeDialog:function(e){e?this.$emit("closeDialog",e):(this.$emit("closeDialog","dialogCluesAdd"),this.$emit("closeDialog","dialogCluesEdit"))}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"form",attrs:{rules:e.form_rules,model:e.form,"label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"线索名称/主题",prop:"theme"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.theme,callback:function(t){e.$set(e.form,"theme",t)},expression:"form.theme"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"线索分类",prop:"classification"}},[a("el-checkbox-group",{model:{value:e.form.classification,callback:function(t){e.$set(e.form,"classification",t)},expression:"form.classification"}},e._l(e.classification,function(t){return a("el-checkbox",{key:t.value_id,attrs:{label:String(t.value_id),name:"type"}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"线索来源",prop:"customer_source"}},[a("el-radio-group",{model:{value:e.form.customer_source,callback:function(t){e.$set(e.form,"customer_source",t)},expression:"form.customer_source"}},e._l(e.customer_source,function(t){return a("el-radio",{key:t.value_id,attrs:{label:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"购买意向",prop:"purchase_intention"}},[a("el-radio-group",{model:{value:e.form.purchase_intention,callback:function(t){e.$set(e.form,"purchase_intention",t)},expression:"form.purchase_intention"}},e._l(e.purchase_intention,function(t){return a("el-radio",{key:t.value_id,attrs:{label:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"客户姓名",prop:"customer_name"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.customer_name,callback:function(t){e.$set(e.form,"customer_name",t)},expression:"form.customer_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户联系电话",prop:"telephone"}},[a("el-input",{attrs:{placeholder:"请输入",disabled:void 0!==e.id},model:{value:e.form.telephone,callback:function(t){e.$set(e.form,"telephone",t)},expression:"form.telephone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"企业名称"}},[a("el-input",{attrs:{placeholder:"请输入"},on:{blur:function(t){e.existCompany()}},model:{value:e.form.enterprise_name,callback:function(t){e.$set(e.form,"enterprise_name",t)},expression:"form.enterprise_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"职务"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.job,callback:function(t){e.$set(e.form,"job",t)},expression:"form.job"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"意向面积"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"数字，小数点两位，单位平方米",type:"number"},nativeOn:{keyup:function(t){e.onkeyupPrice(t)}},model:{value:e.form.intentional_area,callback:function(t){e.$set(e.form,"intentional_area",t)},expression:"form.intentional_area"}}),e._v(" 平米\n        ")],1),e._v(" "),a("el-form-item",{attrs:{label:"电子邮箱"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.company_email,callback:function(t){e.$set(e.form,"company_email",t)},expression:"form.company_email"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"通讯地址"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.communication_address,callback:function(t){e.$set(e.form,"communication_address",t)},expression:"form.communication_address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系人"}},[e._l(e.ContactsList,function(t,i){return a("el-tag",{key:i,attrs:{type:"success",closable:"","disable-transitions":!1},on:{close:function(a){e.closeTag(t,i)}}},[e._v("\n                "+e._s(t.linkman_name)+"\n            ")])}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-web-add",plain:""},on:{click:function(t){e.dialogContactsAdd=!0}}},[e._v("新增联系人")])],2),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:function(t){e.closeDialog()}}},[e._v("取消")])],1)],1),e._v(" "),e.dialogContactsAdd?a("el-dialog",{attrs:{title:"新增联系人",visible:e.dialogContactsAdd,"append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.dialogContactsAdd=t}}},[a("ContactsAdd",{on:{closeThisDialog:e.closeThisDialog,parentSetContactsList:e.setContactsList}})],1):e._e()],1)},staticRenderFns:[]};var m=a("Aizv")(l,c,!1,function(e){a("wQ/k")},"data-v-bbd0e292",null).exports,u=a("5BUm"),d={data:function(){return{form:{theme:"",classification:[],purchase_intention:"",customer_name:"",telephone:"",intentional_area:"",customer_type:1,person_identification_type:"",person_identification_number:"",enterprise_name:"",company_identification_type:"",company_identification_number:""},rawform:{person_identification_type:"",person_identification_number:"",enterprise_name:"",company_identification_type:"",company_identification_number:""},form_rules:{theme:[{required:!0,message:"线索主题不能为空",trigger:"blur"}],classification:[{type:"array",required:!0,message:"请至少选择一个分类",trigger:"change"}],purchase_intention:[{required:!0,message:"请选择购买意向",trigger:"change"}],customer_name:[{required:!0,message:"客户姓名不能为空",trigger:"blur"}],customer_type:[{required:!0,message:"请选择客户类别",trigger:"change"}]},classification:[],purchase_intention:[],identification_type:[],company_card_type:[]}},props:{id:{type:Number}},created:function(){var e=this;this.$https.all([this.getDic("crm_classification","classification"),this.getDic("crm_purchase_intention","purchase_intention"),this.getDic("contact_card_type","identification_type"),this.getDic("company_card_type","company_card_type")]).then(this.$https.spread(function(t,a){console.log(e.id),e.id&&e.getOldData()}))},methods:{closeThisDialog:function(e){this[e]=!1},getOldData:function(){var e=this;this.$https.get("/api/Customer/get_customerdetails?c_id="+this.id).then(function(t){if(0==t.data.code){var a=t.data.data;e.form.theme=a.theme,e.form.classification=a.classification.split(","),e.form.purchase_intention=a.purchase_intention,e.form.customer_name=a.customer_name,e.form.telephone=a.telephone,e.form.intentional_area=0==a.intentional_area?"":a.intentional_area,e.form.enterprise_name=a.enterprise_name,e.form.company_identification_type=a.company_identification_type,e.form.company_identification_number=a.company_identification_number,e.form.person_identification_type=a.person_identification_type,e.form.person_identification_number=a.person_identification_number,e.rawform.enterprise_name=a.enterprise_name,e.rawform.company_identification_type=a.company_identification_type,e.rawform.company_identification_number=a.company_identification_number,e.rawform.person_identification_type=a.person_identification_type,e.rawform.person_identification_number=a.person_identification_number}else e.$message({type:"error",showClose:!0,message:t.data.message})})},submit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return console.error("验证失败"),!1;var a=JSON.parse(s()(e.form));if(a.c_id=parseInt(e.id),1==a.customer_type){if(""==a.person_identification_type)return void e.$message({type:"error",showClose:!0,message:"请选择个人证件类型"});if(""==a.person_identification_number)return void e.$message({type:"error",showClose:!0,message:"请填写个人证件号码"});a.enterprise_name=e.rawform.enterprise_name,a.company_identification_type=e.rawform.company_identification_type,a.company_identification_number=e.rawform.company_identification_number}else{if(""==a.enterprise_name)return void e.$message({type:"error",showClose:!0,message:"请填写企业名称"});if(""==a.company_identification_type)return void e.$message({type:"error",showClose:!0,message:"请选择企业证件类型"});if(""==a.company_identification_number)return void e.$message({type:"error",showClose:!0,message:"请填写企业证件号码"});a.person_identification_type=e.rawform.person_identification_type,a.person_identification_number=e.rawform.person_identification_number}a.classification=e.form.classification.join(","),a.intentional_area=""==e.form.intentional_area?0:e.form.intentional_area,e.$https.post("/api/Customer/update_customer_clue_to_sale",a).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"已成功将该客户转换为机会客户",duration:1500,onClose:function(){e.closeDialog(),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})})},getDic:function(e,t){var a=this;this.$https.get("/api/Dicts/GetValues",{params:{type_code:e}}).then(function(e){0==e.data.code?a[t]=e.data.data:a.$message({type:"error",showClose:!0,message:e.data.message})})},closeDialog:function(e){e?this.$emit("closeDialog",e):this.$emit("closeDialog","dialogCluesToChance")}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"form",attrs:{rules:e.form_rules,model:e.form,"label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"购买意向",prop:"purchase_intention"}},[a("el-radio-group",{model:{value:e.form.purchase_intention,callback:function(t){e.$set(e.form,"purchase_intention",t)},expression:"form.purchase_intention"}},e._l(e.purchase_intention,function(t){return a("el-radio",{key:t.value_id,attrs:{label:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"线索分类",prop:"classification"}},[a("el-checkbox-group",{model:{value:e.form.classification,callback:function(t){e.$set(e.form,"classification",t)},expression:"form.classification"}},e._l(e.classification,function(t){return a("el-checkbox",{key:t.value_id,attrs:{label:String(t.value_id),name:"type"}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"线索名称/主题",prop:"theme"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.theme,callback:function(t){e.$set(e.form,"theme",t)},expression:"form.theme"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户姓名",prop:"customer_name"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.customer_name,callback:function(t){e.$set(e.form,"customer_name",t)},expression:"form.customer_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"客户联系电话"}},[a("p",[e._v(e._s(e.form.telephone))])]),e._v(" "),a("el-form-item",{attrs:{label:"意向面积"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"数字，小数点两位，单位平方米",type:"number"},nativeOn:{keyup:function(t){e.onkeyupPrice(t)}},model:{value:e.form.intentional_area,callback:function(t){e.$set(e.form,"intentional_area",t)},expression:"form.intentional_area"}}),e._v(" 平米\n        ")],1),e._v(" "),a("el-form-item",{attrs:{label:"客户主体类别",prop:"customer_type"}},[a("el-radio-group",{model:{value:e.form.customer_type,callback:function(t){e.$set(e.form,"customer_type",t)},expression:"form.customer_type"}},[a("el-radio",{attrs:{label:1}},[e._v("个人")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("企业")])],1)],1),e._v(" "),1==e.form.customer_type?a("div",[a("el-form-item",{attrs:{label:"个人证件类型"}},[a("el-select",{model:{value:e.form.person_identification_type,callback:function(t){e.$set(e.form,"person_identification_type",t)},expression:"form.person_identification_type"}},e._l(e.identification_type,function(t){return a("el-option",{key:t.value_id,attrs:{label:t.value_name,value:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"个人证件号码",prop:"person_identification_number"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.person_identification_number,callback:function(t){e.$set(e.form,"person_identification_number",t)},expression:"form.person_identification_number"}})],1)],1):e._e(),e._v(" "),2==e.form.customer_type?a("div",[a("el-form-item",{attrs:{label:"企业名称"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.enterprise_name,callback:function(t){e.$set(e.form,"enterprise_name",t)},expression:"form.enterprise_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"企业证件类型"}},[a("el-select",{model:{value:e.form.company_identification_type,callback:function(t){e.$set(e.form,"company_identification_type",t)},expression:"form.company_identification_type"}},e._l(e.company_card_type,function(t){return a("el-option",{key:t.value_id,attrs:{label:t.value_name,value:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"企业证件号码"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.company_identification_number,callback:function(t){e.$set(e.form,"company_identification_number",t)},expression:"form.company_identification_number"}})],1)],1):e._e(),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:function(t){e.closeDialog()}}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var _=a("Aizv")(d,p,!1,function(e){a("JsVN")},"data-v-5e934932",null).exports,f=a("M05L"),h={components:{ContactsAdd:r.a,PhotosUploader:f.a},data:function(){return{form:{user_id:""},form_rules:{user_id:[{required:!0,message:"请选择业务员",trigger:"change"}]},tableData:[],purchase_intention:[],usersAll:[]}},props:{users:{type:Array}},created:function(){var e=this;this.$https.all([this.getDic("crm_purchase_intention","purchase_intention"),this.getUsersAll()]).then(this.$https.spread(function(t,a){e.tableData=e.users,console.log(e.tableData)}))},methods:{getUsersAll:function(){var e=this;this.$https.get("/api/Account/list_users_all").then(function(t){0==t.data.code?e.usersAll=t.data.data:e.$message({type:"error",showClose:!0,message:t.data.message})})},submit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return console.error("验证失败"),!1;var a={user_id:e.form.user_id},i=[],n=!0,s=!1,r=void 0;try{for(var l,c=o()(e.users);!(n=(l=c.next()).done);n=!0){var m=l.value;i.push(m.c_id)}}catch(e){s=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(s)throw r}}a.list_c_id=i,e.$https.post("/api/Customer/update_customer_user_id",a).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"选中客户业务员变更成功",duration:1500,onClose:function(){e.closeDialog("dialogChangeSalesman"),e.$emit("parentSetContactsList",a)}}):e.$message({type:"error",showClose:!0,message:t.data.message})})})},getDic:function(e,t){var a=this;this.$https.get("/api/Dicts/GetValues",{params:{type_code:e}}).then(function(e){0==e.data.code?a[t]=e.data.data:a.$message({type:"error",showClose:!0,message:e.data.message})})},getDicVal:function(e,t){var a="",i=!0,n=!1,s=void 0;try{for(var r,l=o()(this[t]);!(i=(r=l.next()).done);i=!0){var c=r.value;e==c.value_id&&(a=c.value_name)}}catch(e){n=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw s}}return a},closeDialog:function(e){e?this.$emit("closeDialog",e):this.$emit("closeDialog","dialogChangeSalesman")}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"form",attrs:{rules:e.form_rules,model:e.form,"label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"业务员变更为：",prop:"user_id"}},[a("el-select",{model:{value:e.form.user_id,callback:function(t){e.$set(e.form,"user_id",t)},expression:"form.user_id"}},e._l(e.usersAll,function(t){return a("el-option",{key:t.user_id,attrs:{label:t.user_name,value:String(t.user_id)}},[e._v(e._s(t.user_name))])}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:function(t){e.closeDialog()}}},[e._v("取消")])],1)],1),e._v(" "),a("h3",{staticClass:"table_title"},[e._v("已选中客户：")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{prop:"c_id",label:"ID",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"enterprise_name",label:"公司名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"customer_name",label:"联系人姓名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"telephone",label:"联系电话"}}),e._v(" "),a("el-table-column",{attrs:{label:"购买意向"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.getDicVal(t.row.purchase_intention,"purchase_intention"))+"\n            ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"user_name",label:"原业务员"}}),e._v(" "),a("el-table-column",{attrs:{prop:"created_time",label:"创建时间"}})],1)],1)},staticRenderFns:[]};var v=a("Aizv")(h,g,!1,function(e){a("Fz0F")},"data-v-5f906a90",null).exports,b=a("zGNL"),y={components:{CluesAdd:m,FollowUp:u.a,CluesToChance:_,ChangeSalesman:v,Details:b.a},data:function(){return{editId:null,FollowUpObj:null,pageIndex:1,pageSize:10,dataTotal:0,loading:!0,formFilter:{enterprise_name:"",customer_name:"",telephone:"",theme:"",user_id:"-2",purchase_intention:""},searchForm:{enterprise_name:"",customer_name:"",telephone:"",theme:""},selectionChecked:[],tableData:[],classification:[],purchase_intention:[],roleunitUsers:[],dialogCluesAdd:!1,dialogCluesEdit:!1,dialogDetails:!1,dialogFollowUp:!1,dialogChangeSalesman:!1,dialogCluesToChance:!1}},created:function(){this.$https.all([this.getDic("crm_classification","classification"),this.getDic("crm_purchase_intention","purchase_intention"),this.getRoleunitUsers(),this.getDataList()]).then(this.$https.spread(function(e,t){}))},watch:{"formFilter.purchase_intention":function(){this.getDataList()},"formFilter.user_id":function(){this.getDataList()}},methods:{pageSizeChange:function(e){this.pageSize=e,this.getDataList()},pageIndexChange:function(e){this.pageIndex=e,this.getDataList()},closeDialog:function(e){this[e]=!1},cluesEdit:function(e){this.editId=Number(e),this.dialogCluesEdit=!0},openDetails:function(e){this.editId=Number(e),this.dialogDetails=!0},FollowUp:function(e,t,a){this.FollowUpObj={id:Number(e),name:t,type:a},this.dialogFollowUp=!0},cluesToChance:function(e){this.editId=Number(e),this.dialogCluesToChance=!0},getDic:function(e,t){var a=this;this.$https.get("/api/Dicts/GetValues",{params:{type_code:e}}).then(function(e){0==e.data.code?a[t]=e.data.data:a.$message({type:"error",showClose:!0,message:e.data.message})})},getDicVal:function(e,t){var a="",i=!0,n=!1,s=void 0;try{for(var r,l=o()(this[t]);!(i=(r=l.next()).done);i=!0){var c=r.value;e==c.value_id&&(a=c.value_name)}}catch(e){n=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw s}}return a},getDicVals:function(e,t){var a=[],i=e.split(","),n=!0,s=!1,r=void 0;try{for(var l,c=o()(i);!(n=(l=c.next()).done);n=!0){var m=l.value,u=!0,d=!1,p=void 0;try{for(var _,f=o()(this[t]);!(u=(_=f.next()).done);u=!0){var h=_.value;m==h.value_id&&a.push(h.value_name)}}catch(e){d=!0,p=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw p}}}}catch(e){s=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(s)throw r}}return a.join(", ")},handleSelectionChange:function(e){this.selectionChecked=e,console.info(this.selectionChecked)},formFilterSubmit:function(){this.searchForm.enterprise_name=this.formFilter.enterprise_name,this.searchForm.customer_name=this.formFilter.customer_name,this.searchForm.telephone=this.formFilter.telephone,this.searchForm.theme=this.formFilter.theme,this.getDataList()},crmDel:function(){var e=this;0===this.selectionChecked.length?this.$message({type:"error",showClose:!0,message:"您未勾选需要删除的客户"}):this.$prompt("请输入删除原因","删除需要总监确认。您还可以将其丢入公海",{inputType:"textarea",confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(t){var a=t.value,i=[],n=!0,s=!1,r=void 0;try{for(var l,c=o()(e.selectionChecked);!(n=(l=c.next()).done);n=!0){var m=l.value,u={c_id:m.c_id,old_user_id:m.user_id,apply_remark:a};i.push(u)}}catch(e){s=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(s)throw r}}e.$https.post("/api/customer_delete_approve/create_customer_delete_approve",i).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"删除成功",duration:1500,onClose:function(){e.getDataList()}}):e.$message({type:"error",showClose:!0,message:t.data.message})})})},crmToPublic:function(){var e=this;if(0===this.selectionChecked.length)this.$message({type:"error",showClose:!0,message:"您未勾选需要丢入公海的客户"});else{var t=[],a=!0,i=!1,n=void 0;try{for(var s,r=o()(this.selectionChecked);!(a=(s=r.next()).done);a=!0){var l=s.value,c={c_id:l.c_id,user_id:l.user_id};t.push(c)}}catch(e){i=!0,n=e}finally{try{!a&&r.return&&r.return()}finally{if(i)throw n}}this.$https.post("/api/Customer/update_customer_to_public",t).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"已将选中客户转入公海",duration:1500,onClose:function(){e.getDataList()}}):e.$message({type:"error",showClose:!0,message:t.data.message})})}},changeSalesman:function(){0===this.selectionChecked.length?this.$message({type:"error",showClose:!0,message:"您未勾选需要变更业务员的客户"}):this.dialogChangeSalesman=!0},cluesDemand:function(e){this.$message({type:"error",showClose:!0,message:"敬请期待"})},getRoleunitUsers:function(){var e=this;this.$https.get("/api/Account/list_users_by_roleunit").then(function(t){if(0==t.data.code){var a=!0,i=!1,n=void 0;try{for(var s,r=o()(t.data.data);!(a=(s=r.next()).done);a=!0){var l=s.value,c={id:l.user_id,name:l.user_name};e.roleunitUsers.push(c)}}catch(e){i=!0,n=e}finally{try{!a&&r.return&&r.return()}finally{if(i)throw n}}}else e.$message({type:"error",showClose:!0,message:t.data.message})})},getDataList:function(){var e=this;this.$https.get("/api/Customer/page",{params:{currentPage:this.pageIndex,pageSize:this.pageSize,customer_classify:0,enterprise_name:this.searchForm.enterprise_name,customer_name:this.searchForm.customer_name,telephone:this.searchForm.telephone,theme:this.searchForm.theme,user_id:""==this.formFilter.user_id?"-2":this.formFilter.user_id,purchase_intention:this.formFilter.purchase_intention}}).then(function(t){0==t.data.code?(e.tableData=t.data.data.Items,e.dataTotal=t.data.data.Total,e.loading=!1):e.$message({type:"error",showClose:!0,message:t.data.message})})}}},C={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("我的线索客户")]),e._v(" "),a("el-button-group",{staticStyle:{float:"right"}},[a("el-button",{attrs:{icon:"el-icon-refresh",size:"mini",plain:"",onclick:"window.location.reload()"}},[e._v("刷新")])],1)],1),e._v(" "),a("el-form",{staticClass:"clues_form_seach",attrs:{inline:!0,model:e.formFilter,size:"small"}},[a("el-form-item",{attrs:{label:"公司名称"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formFilter.enterprise_name,callback:function(t){e.$set(e.formFilter,"enterprise_name",t)},expression:"formFilter.enterprise_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系人姓名"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formFilter.customer_name,callback:function(t){e.$set(e.formFilter,"customer_name",t)},expression:"formFilter.customer_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formFilter.telephone,callback:function(t){e.$set(e.formFilter,"telephone",t)},expression:"formFilter.telephone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"主题"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formFilter.theme,callback:function(t){e.$set(e.formFilter,"theme",t)},expression:"formFilter.theme"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.formFilterSubmit}},[e._v("查询")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(t){e.crmDel()}}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(t){e.crmToPublic()}}},[e._v("丢公海")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"info",icon:"el-icon-web-loop"},on:{click:function(t){e.changeSalesman()}}},[e._v("变更业务员")]),e._v(" "),a("el-select",{staticStyle:{width:"150px","margin-left":"20px","vertical-align":"middle"},attrs:{size:"small",placeholder:"请选择业务员"},model:{value:e.formFilter.user_id,callback:function(t){e.$set(e.formFilter,"user_id",t)},expression:"formFilter.user_id"}},[a("el-option",{attrs:{label:"本人",value:"-2"}}),e._v(" "),e._l(e.roleunitUsers,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})],2),e._v(" "),a("el-select",{staticStyle:{width:"150px","vertical-align":"middle"},attrs:{size:"small",placeholder:"请选择购买意向"},model:{value:e.formFilter.purchase_intention,callback:function(t){e.$set(e.formFilter,"purchase_intention",t)},expression:"formFilter.purchase_intention"}},[a("el-option",{attrs:{label:"所有购买意向",value:""}}),e._v(" "),e._l(e.purchase_intention,function(e){return a("el-option",{key:e.value_id,attrs:{label:e.value_name,value:e.value_id}})})],2)],1),e._v(" "),a("el-col",{staticClass:"text-right",attrs:{span:6}},[a("el-button",{attrs:{size:"small",type:"success",onclick:"alert('敬请期待')",icon:"el-icon-upload"}},[e._v("导入")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"success",onclick:"alert('敬请期待')",icon:"el-icon-web-download"}},[e._v("导出")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){e.dialogCluesAdd=!0}}},[e._v("新增")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",prop:"c_id"}}),e._v(" "),a("el-table-column",{attrs:{prop:"c_id",label:"ID",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"theme",label:"主题"}}),e._v(" "),a("el-table-column",{attrs:{prop:"enterprise_name",label:"公司名称"}}),e._v(" "),a("el-table-column",{attrs:{label:"客户姓名"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:;"},on:{click:function(a){e.openDetails(t.row.c_id)}}},[e._v(e._s(t.row.customer_name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"telephone",label:"联系电话"}}),e._v(" "),a("el-table-column",{attrs:{label:"客户分类"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.getDicVals(t.row.classification,"classification"))+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"购买意向"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.getDicVal(t.row.purchase_intention,"purchase_intention"))+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"intentional_area",label:"意向面积"}}),e._v(" "),a("el-table-column",{attrs:{prop:"user_name",label:"业务员"}}),e._v(" "),a("el-table-column",{attrs:{prop:"created_time",label:"创建时间"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(a){e.cluesEdit(t.row.c_id)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"warning",plain:""},on:{click:function(a){e.FollowUp(t.row.c_id,t.row.customer_name,t.row.purchase_intention)}}},[e._v("跟进记录")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"success",plain:""},on:{click:function(a){e.cluesToChance(t.row.c_id)}}},[e._v("转机会客户")]),e._v(" "),a("el-button",{attrs:{size:"mini",plain:""},on:{click:function(a){e.cluesDemand(t.row.c_id)}}},[e._v("需求")])]}}])})],1),e._v(" "),a("div",{staticClass:"text-center m-t"},[a("el-pagination",{attrs:{"current-page":e.pageIndex,"page-sizes":[10,15,20,30],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.dataTotal},on:{"size-change":e.pageSizeChange,"current-change":e.pageIndexChange}})],1)],1),e._v(" "),e.dialogCluesAdd?a("el-dialog",{attrs:{title:"新增线索客户",visible:e.dialogCluesAdd,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogCluesAdd=t}}},[a("CluesAdd",{on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogCluesEdit?a("el-dialog",{attrs:{title:"编辑线索客户",visible:e.dialogCluesEdit,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogCluesEdit=t}}},[a("CluesAdd",{attrs:{id:e.editId},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogFollowUp?a("el-dialog",{attrs:{title:"跟进记录",visible:e.dialogFollowUp,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogFollowUp=t}}},[a("FollowUp",{attrs:{followData:e.FollowUpObj},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogCluesToChance?a("el-dialog",{attrs:{title:"线索客户转机会客户",visible:e.dialogCluesToChance,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogCluesToChance=t}}},[a("CluesToChance",{attrs:{id:e.editId},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogChangeSalesman?a("el-dialog",{attrs:{title:"变更业务员",visible:e.dialogChangeSalesman,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogChangeSalesman=t}}},[a("ChangeSalesman",{attrs:{users:e.selectionChecked},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogDetails?a("el-dialog",{attrs:{title:"客户详情",visible:e.dialogDetails,"append-to-body":"",width:"1000px"},on:{"update:visible":function(t){e.dialogDetails=t}}},[a("Details",{attrs:{id:e.editId},on:{closeDialog:e.closeDialog}})],1):e._e()],1)},staticRenderFns:[]};var w=a("Aizv")(y,C,!1,function(e){a("YaJl")},"data-v-9207c882",null);t.default=w.exports},YaJl:function(e,t){},"wQ/k":function(e,t){}});
//# sourceMappingURL=5.28718221ffcda2b171b5.js.map