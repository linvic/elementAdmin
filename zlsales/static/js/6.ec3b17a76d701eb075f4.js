webpackJsonp([6],{"/BGE":function(e,t){},"6NBX":function(e,t){},au9U:function(e,t){},wAq8:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={components:{PhotoUploader:a("+8MW").a},data:function(){return{form:{org_id:null,user_account:"",user_telephone:"",user_pwd:"",user_name:"",job_number:"",user_img:"",position_id:"",user_email:"",user_desc:""},form_rules:{org_id:[{required:!0,message:"请选择所属组织",trigger:"change"}],user_account:[{required:!0,message:"请输入用户账号",trigger:"blur"}],user_telephone:[{required:!0,message:"请输入用户手机号",trigger:"blur"}],user_pwd:[{required:!0,message:"请输入用户登录密码",trigger:"blur"},{min:6,message:"长度不少于6位",trigger:"blur"}],user_name:[{required:!0,message:"请输入用户姓名",trigger:"blur"}],position_id:[{required:!0,message:"请选择所属职位",trigger:"change"}],user_desc:[{required:!0,message:"请输入用户备注",trigger:"blur"}]},optionsValue:[],options:[],optionsProps:{value:"id",label:"text",children:"children"},positions:[]}},props:{id:{type:Number},pid:{type:[Number,String]}},created:function(){console.log(this.id),this.getDataTree()},computed:{},watch:{"form.org_id":function(e){this.getPositions(e)}},methods:{getPositions:function(e){var t=this;this.$https.get("/api/company_user_unit_position/page",{params:{currentPage:1,pageSize:999,unit_id:e}}).then(function(e){0==e.data.code?t.positions=e.data.data.Items:t.$message({type:"error",showClose:!0,message:e.data.message})})},getDataTree:function(){var e=this;this.$https.get("/api/company_unit/GetUnitsTree").then(function(t){0==t.data.code?(e.options=t.data.data,e.pid&&0!=e.pid&&(e.form.org_id=e.pid,e.optionsValue=e.getTreeDeepArr(e.pid,e.options)),e.id&&e.getOldData()):e.$message({type:"error",showClose:!0,message:t.data.message})})},getOldData:function(){var e=this;this.$https.get("/api/Account/get_users_details?user_id="+this.id).then(function(t){if(0==t.data.code){var a=t.data.data;e.form.org_id=a.org_id,e.optionsValue=e.getTreeDeepArr(a.org_id,e.options),e.form.user_account=a.user_account,e.form.user_telephone=a.user_telephone,e.form.user_name=a.user_name,e.form.job_number=a.job_number,e.form.user_img=a.user_img,e.form.position_id=0==a.position_id?"":a.position_id.toString(),e.form.user_email=a.user_email,e.form.user_desc=a.user_desc}else e.$message({type:"error",showClose:!0,message:t.data.message})})},submit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return console.error("验证失败"),!1;var a=e.form;e.id?(a.user_id=parseInt(e.id),e.$https.post("/api/Account/update_users",a).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"编辑成功",duration:1500,onClose:function(){e.closeDialog("dialogUserEdit"),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})):e.$https.post("/api/Account/create_users",a).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"添加成功",duration:1500,onClose:function(){e.closeDialog("dialogUserAdd"),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})})},closeDialog:function(e){e?this.$emit("closeDialog",e):(this.$emit("closeDialog","dialogUserAdd"),this.$emit("closeDialog","dialogUserEdit"))},cascaderChange:function(e){this.form.org_id=e[e.length-1]},getTreeDeepArr:function(e,t){var a=[],s=[],o=0;return function t(i,r){for(var n=0;n<i.length;n++){if(o=r,a[r]=i[n].id,i[n].id==e){s=a.slice(0,r+1);break}i[n].children&&(o++,t(i[n].children,o))}return s}(t,o)}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"form",attrs:{"status-icon":"",rules:e.form_rules,model:e.form,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"所属部门",prop:"org_id"}},[a("el-cascader",{attrs:{options:e.options,props:e.optionsProps,"show-all-levels":!1,"change-on-select":"",clearable:""},on:{change:e.cascaderChange},model:{value:e.optionsValue,callback:function(t){e.optionsValue=t},expression:"optionsValue"}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"账号",prop:"user_account"}},[a("el-input",{attrs:{disabled:void 0!==e.id},model:{value:e.form.user_account,callback:function(t){e.$set(e.form,"user_account",t)},expression:"form.user_account"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"手机号",prop:"user_telephone"}},[a("el-input",{model:{value:e.form.user_telephone,callback:function(t){e.$set(e.form,"user_telephone",t)},expression:"form.user_telephone"}})],1)],1)],1),e._v(" "),a("el-row",[e.id?e._e():a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"登录密码",prop:"user_pwd"}},[a("el-input",{model:{value:e.form.user_pwd,callback:function(t){e.$set(e.form,"user_pwd",t)},expression:"form.user_pwd"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"姓名",prop:"user_name"}},[a("el-input",{model:{value:e.form.user_name,callback:function(t){e.$set(e.form,"user_name",t)},expression:"form.user_name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工号"}},[a("el-input",{model:{value:e.form.job_number,callback:function(t){e.$set(e.form,"job_number",t)},expression:"form.job_number"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"工作照"}},[a("PhotoUploader",{attrs:{files:e.form.user_img},on:{"update:files":function(t){e.$set(e.form,"user_img",t)}}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"所属职位",prop:"position_id"}},[a("el-select",{attrs:{"no-data-text":"该组织下尚未配置职位"},model:{value:e.form.position_id,callback:function(t){e.$set(e.form,"position_id",t)},expression:"form.position_id"}},e._l(e.positions,function(t){return a("el-option",{key:t.id,attrs:{label:t.position_name,value:String(t.id)}},[e._v(e._s(t.position_name))])}))],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"电子邮箱"}},[a("el-input",{model:{value:e.form.user_email,callback:function(t){e.$set(e.form,"user_email",t)},expression:"form.user_email"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"备注："}},[a("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.form.user_desc,callback:function(t){e.$set(e.form,"user_desc",t)},expression:"form.user_desc"}})],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:function(t){e.closeDialog()}}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var i=a("Aizv")(s,o,!1,function(e){a("/BGE")},"data-v-27fc48da",null).exports,r=a("u6qr"),n=a.n(r),l={data:function(){return{baseData:[],value:[],baseProps:{key:"role_id",label:"role_name"}}},props:{id:{type:Number}},created:function(){this.getDataBase()},computed:{},watch:{},methods:{getDataBase:function(){var e=this;this.$https.get("/api/company_role/page",{params:{currentPage:1,pageSize:999}}).then(function(t){0==t.data.code?(e.baseData=t.data.data.Items,e.getOldData()):e.$message({type:"error",showClose:!0,message:t.data.message})})},getOldData:function(){var e=this;this.$https.get("/api/company_role/list_company_role_user?user_id="+this.id).then(function(t){if(0==t.data.code){var a=t.data.data;console.log(a);var s=!0,o=!1,i=void 0;try{for(var r,l=n()(a);!(s=(r=l.next()).done);s=!0){var c=r.value;e.value.push(c.role_id)}}catch(e){o=!0,i=e}finally{try{!s&&l.return&&l.return()}finally{if(o)throw i}}}else e.$message({type:"error",showClose:!0,message:t.data.message})})},submit:function(){var e=this,t=[],a=!0,s=!1,o=void 0;try{for(var i,r=n()(this.value);!(a=(i=r.next()).done);a=!0){var l=i.value;console.log(l);var c={user_id:this.id,role_id:l};t.push(c)}}catch(e){s=!0,o=e}finally{try{!a&&r.return&&r.return()}finally{if(s)throw o}}console.log("您将提交：",t),this.$https.post("/api/company_role/create_company_role_user",t).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"配置成功",duration:1500,onClose:function(){e.closeDialog("dialogUserRole"),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})},closeDialog:function(e){e?this.$emit("closeDialog",e):this.$emit("closeDialog","dialogUserRole")}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-transfer",{attrs:{titles:["可选角色","已选角色"],data:e.baseData,props:e.baseProps},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),e._v(" "),a("div",{staticClass:"m-t text-center"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:function(t){e.closeDialog()}}},[e._v("取消")])],1)],1)},staticRenderFns:[]};var u={components:{UserAdd:i,UserRole:a("Aizv")(l,c,!1,function(e){a("au9U")},"data-v-3cbcaef6",null).exports},data:function(){return{loading:!1,editId:null,filterText:"",dicData:[],treeProps:{label:"text",children:"children"},currentUserTypeTxt:"",currentUserType:0,tableData:[],dialogUserAdd:!1,dialogUserEdit:!1,dialogUserRole:!1,pageIndex:1,pageSize:10,dataTotal:0}},created:function(){this.getDataTree(),this.getDataList()},watch:{filterText:function(e){this.pageIndex=1,this.pageSize=10,this.getDataList()}},methods:{getDataTree:function(){var e=this;this.$https.get("/api/company_unit/GetUnitsTree").then(function(t){0==t.data.code?e.dicData=t.data.data:e.$message({type:"error",showClose:!0,message:t.data.message})})},getDataList:function(){var e=this;this.loading=!0,this.$https.get("/api/Account/page_users_seach_user_account_name",{params:{currentPage:this.pageIndex,pageSize:this.pageSize,unit_id:this.currentUserType,keyword:this.filterText}}).then(function(t){e.loading=!1,0==t.data.code?(e.tableData=t.data.data.Items,e.dataTotal=t.data.data.Total):e.$message({type:"error",showClose:!0,message:t.data.message})})},handleNodeClick:function(e){this.currentUserType=e.id,this.filterText="",this.pageIndex=1,this.pageSize=10,this.currentUserTypeTxt=" - "+e.text,this.getDataList()},closeDialog:function(e){this[e]=!1},listEdit:function(e){this.editId=Number(e),this.dialogUserEdit=!0},UserRole:function(e){this.editId=Number(e),this.dialogUserRole=!0},changeState:function(e,t){var a=this;this.$https.post("/api/Account/update_users_status",{user_id:e,account_status:t?1:0}).then(function(e){if(0==e.data.code){var s=t?"启用成功":"禁用成功";a.$message({type:"success",showClose:!0,message:s,duration:1500,onClose:function(){a.getDataList()}})}else a.$message({type:"error",showClose:!0,message:e.data.message})})},isAdmin:function(e,t){var a=this;this.$https.post("/api/Account/update_users_isadmin",{user_id:e,isadmin:t?1:0}).then(function(e){if(0==e.data.code){var s=t?"设置成功":"取消成功";a.$message({type:"success",showClose:!0,message:s,duration:1500,onClose:function(){a.getDataList()}})}else a.$message({type:"error",showClose:!0,message:e.data.message})})},resetPwd:function(e){var t=this;this.$confirm("您确定要将该用户的密码重置为 888888 吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$https.post("/api/Account/update_users_pwd_init",{user_id:e,user_pwd:"888888"}).then(function(e){0==e.data.code?t.$message({type:"success",showClose:!0,message:"密码重置成功",duration:1500,onClose:function(){t.getDataList()}}):t.$message({type:"error",showClose:!0,message:e.data.message})})}).catch(function(){})},pageSizeChange:function(e){this.pageSize=e,this.getDataList()},pageIndexChange:function(e){this.pageIndex=e,this.getDataList()}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-container",[a("el-aside",{attrs:{width:"200px"}},[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("组织架构")])]),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.dicData,props:e.treeProps,"default-expand-all":"","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick}})],1)],1),e._v(" "),a("el-main",{staticClass:"dicMain"},[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("用户管理"+e._s(e.currentUserTypeTxt))]),e._v(" "),a("el-button-group",{staticStyle:{float:"right"}},[a("el-button",{attrs:{icon:"el-icon-refresh",size:"small",plain:"",onclick:"window.location.reload()"}},[e._v("刷新")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline",size:"small"},on:{click:function(t){e.dialogUserAdd=!0}}},[e._v("新增")])],1)],1),e._v(" "),a("el-input",{staticStyle:{"max-width":"320px"},attrs:{placeholder:"输入关键字进行过滤","suffix-icon":"el-icon-search"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"user_id",label:"用户ID",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"user_name",label:"用户名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"user_account",label:"用户账号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"user_telephone",label:"用户手机号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(1===t.row.account_status?"正常":"禁用"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"480"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.account_status?a("el-button",{attrs:{size:"mini",plain:""},on:{click:function(a){e.changeState(t.row.user_id,!1)}}},[e._v("禁用")]):a("el-button",{attrs:{size:"mini",plain:""},on:{click:function(a){e.changeState(t.row.user_id,!0)}}},[e._v("启用")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(a){e.resetPwd(t.row.user_id)}}},[e._v("重置密码")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(a){e.listEdit(t.row.user_id)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"success",plain:""},on:{click:function(a){e.UserRole(t.row.user_id)}}},[e._v("角色配置")]),e._v(" "),1!=t.row.isadmin?a("el-button",{attrs:{size:"mini",type:"warning",plain:""},on:{click:function(a){e.isAdmin(t.row.user_id,!0)}}},[e._v("设为超管")]):a("el-button",{attrs:{size:"mini",type:"warning",plain:""},on:{click:function(a){e.isAdmin(t.row.user_id,!1)}}},[e._v("取消超管")])]}}])})],1),e._v(" "),a("div",{staticClass:"text-center m-t"},[a("el-pagination",{attrs:{"current-page":e.pageIndex,"page-sizes":[10,15,20,30],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.dataTotal},on:{"size-change":e.pageSizeChange,"current-change":e.pageIndexChange}})],1)],1)],1)],1),e._v(" "),e.dialogUserAdd?a("el-dialog",{attrs:{title:"新增用户",visible:e.dialogUserAdd,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogUserAdd=t}}},[a("UserAdd",{attrs:{pid:e.currentUserType},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogUserEdit?a("el-dialog",{attrs:{title:"编辑用户信息",visible:e.dialogUserEdit,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogUserEdit=t}}},[a("UserAdd",{attrs:{id:e.editId},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogUserRole?a("el-dialog",{attrs:{title:"用户角色配置",visible:e.dialogUserRole,"append-to-body":"",width:"540px"},on:{"update:visible":function(t){e.dialogUserRole=t}}},[a("UserRole",{attrs:{id:e.editId},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e()],1)},staticRenderFns:[]};var p=a("Aizv")(u,d,!1,function(e){a("6NBX")},"data-v-1e42c580",null);t.default=p.exports}});
//# sourceMappingURL=6.ec3b17a76d701eb075f4.js.map