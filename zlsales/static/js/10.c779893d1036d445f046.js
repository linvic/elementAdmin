webpackJsonp([10],{C3Zj:function(t,e){},NYtx:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a={data:function(){return{form:{unit_id:null,position_name:"",is_use:"1",position_remark:""},form_rules:{unit_id:[{required:!0,message:"请选择所属组织",trigger:"change"}],position_name:[{required:!0,message:"请输入字典名称",trigger:"blur"}]},optionsValue:[],options:[],optionsProps:{value:"id",label:"text",children:"children"}}},props:{id:{type:Number},pid:{type:[Number,String]}},created:function(){this.getDataTree()},methods:{getDataTree:function(){var t=this;this.$https.get("/api/company_unit/GetUnitsTree").then(function(e){0==e.data.code?(t.options=e.data.data,t.pid&&0!=t.pid&&(t.form.unit_id=t.pid,t.optionsValue=t.getTreeDeepArr(t.pid,t.options)),t.id&&t.getOldData()):t.$message({type:"error",showClose:!0,message:e.data.message})})},getOldData:function(){var t=this;this.$https.get("/api/company_user_unit_position/get_company_user_unit_positiondetails?id="+this.id).then(function(e){if(0==e.data.code){var i=e.data.data;t.form.unit_id=i.unit_id,t.optionsValue=t.getTreeDeepArr(i.unit_id,t.options),t.form.position_name=i.position_name,t.form.is_use=i.is_use.toString(),t.form.position_remark=i.position_remark}else t.$message({type:"error",showClose:!0,message:e.data.message})})},submit:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return console.error("验证失败"),!1;var i={unit_id:t.form.unit_id,position_name:t.form.position_name,is_use:t.form.is_use,position_remark:t.form.position_remark};t.id?(i.id=parseInt(t.id),t.$https.post("/api/company_user_unit_position/update_company_user_unit_position",i).then(function(e){0==e.data.code?t.$message({type:"success",showClose:!0,message:"编辑成功",duration:1500,onClose:function(){t.closeDialog("dialogPositionEdit"),t.$emit("parentGetDataList")}}):t.$message({type:"error",showClose:!0,message:e.data.message})})):t.$https.post("/api/company_user_unit_position/create_company_user_unit_position",i).then(function(e){0==e.data.code?t.$message({type:"success",showClose:!0,message:"添加成功",duration:1500,onClose:function(){t.closeDialog("dialogPositionAdd"),t.$emit("parentGetDataList")}}):t.$message({type:"error",showClose:!0,message:e.data.message})})})},closeDialog:function(t){t?this.$emit("closeDialog",t):(this.$emit("closeDialog","dialogPositionAdd"),this.$emit("closeDialog","dialogPositionEdit"))},cascaderChange:function(t){this.form.unit_id=t[t.length-1]},getTreeDeepArr:function(t,e){var i=[],a=[],o=0;return function e(s,n){for(var r=0;r<s.length;r++){if(o=n,i[n]=s[r].id,s[r].id==t){a=i.slice(0,n+1);break}s[r].children&&(o++,e(s[r].children,o))}return a}(e,o)}}},o={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-form",{ref:"form",attrs:{"status-icon":"",rules:t.form_rules,model:t.form,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"所属组织",prop:"unit_id"}},[i("el-cascader",{attrs:{options:t.options,props:t.optionsProps,"show-all-levels":!1,"change-on-select":"",clearable:""},on:{change:t.cascaderChange},model:{value:t.optionsValue,callback:function(e){t.optionsValue=e},expression:"optionsValue"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"职位名称",prop:"position_name"}},[i("el-input",{model:{value:t.form.position_name,callback:function(e){t.$set(t.form,"position_name",e)},expression:"form.position_name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"是否启用"}},[i("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.form.is_use,callback:function(e){t.$set(t.form,"is_use",e)},expression:"form.is_use"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"职位备注"}},[i("el-input",{attrs:{type:"textarea",rows:3},model:{value:t.form.position_remark,callback:function(e){t.$set(t.form,"position_remark",e)},expression:"form.position_remark"}})],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submit()}}},[t._v("保存")]),t._v(" "),i("el-button",{on:{click:function(e){t.closeDialog()}}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]};var s={components:{PositionAdd:i("Aizv")(a,o,!1,function(t){i("lQcN")},"data-v-aa4bfd62",null).exports},data:function(){return{loading:!1,editId:null,dicData:[],treeProps:{label:"text",children:"children"},currentPositionTypeTxt:"",currentPositionType:0,tableData:[],dialogPositionAdd:!1,dialogPositionEdit:!1,pageIndex:1,pageSize:10,dataTotal:0}},created:function(){this.getDataTree(),this.getDataList()},watch:{},methods:{getDataTree:function(){var t=this;this.$https.get("/api/company_unit/GetUnitsTree").then(function(e){0==e.data.code?t.dicData=e.data.data:t.$message({type:"error",showClose:!0,message:e.data.message})})},getDataList:function(){var t=this;this.loading=!0,this.$https.get("/api/company_user_unit_position/page",{params:{currentPage:this.pageIndex,pageSize:this.pageSize,unit_id:this.currentPositionType}}).then(function(e){t.loading=!1,0==e.data.code?(t.tableData=e.data.data.Items,t.dataTotal=e.data.data.Total):t.$message({type:"error",showClose:!0,message:e.data.message})})},handleNodeClick:function(t){this.currentPositionType=t.id,this.pageIndex=1,this.pageSize=10,this.currentPositionTypeTxt=" - "+t.text,this.getDataList()},closeDialog:function(t){this[t]=!1},dicEdit:function(t){console.log(t),this.editId=Number(t),this.dialogPositionEdit=!0},changeState:function(t,e){var i=this;this.$https.post("/api/company_user_unit_position/update_company_user_unit_position_is_use",{id:t,is_use:e?1:0}).then(function(t){if(0==t.data.code){var a=e?"启用成功":"禁用成功";i.$message({type:"success",showClose:!0,message:a,duration:1500,onClose:function(){i.getDataList()}})}else i.$message({type:"error",showClose:!0,message:t.data.message})})},pageSizeChange:function(t){this.pageSize=t,this.getDataList()},pageIndexChange:function(t){this.pageIndex=t,this.getDataList()}}},n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-container",[i("el-aside",{attrs:{width:"200px"}},[i("el-card",[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[t._v("组织架构")])]),t._v(" "),i("el-tree",{ref:"tree",attrs:{data:t.dicData,props:t.treeProps,"default-expand-all":"","expand-on-click-node":!1},on:{"node-click":t.handleNodeClick}})],1)],1),t._v(" "),i("el-main",{staticClass:"dicMain"},[i("el-card",[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[t._v("职位管理"+t._s(t.currentPositionTypeTxt))]),t._v(" "),i("el-button-group",{staticStyle:{float:"right"}},[i("el-button",{attrs:{icon:"el-icon-refresh",size:"small",plain:"",onclick:"window.location.reload()"}},[t._v("刷新")]),t._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline",size:"small"},on:{click:function(e){t.dialogPositionAdd=!0}}},[t._v("新增")])],1)],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData}},[i("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),t._v(" "),i("el-table-column",{attrs:{prop:"position_name",label:"职位名称"}}),t._v(" "),i("el-table-column",{attrs:{prop:"position_remark",label:"职位备注"}}),t._v(" "),i("el-table-column",{attrs:{prop:"created_time",label:"创建时间"}}),t._v(" "),i("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(1===e.row.is_use?"正常":"禁用"))])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.is_use?i("el-button",{attrs:{size:"mini",plain:""},on:{click:function(i){t.changeState(e.row.id,!1)}}},[t._v("禁用")]):i("el-button",{attrs:{size:"mini",plain:""},on:{click:function(i){t.changeState(e.row.id,!0)}}},[t._v("启用")]),t._v(" "),i("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(i){t.dicEdit(e.row.id)}}},[t._v("编辑")])]}}])})],1),t._v(" "),i("div",{staticClass:"text-center m-t"},[i("el-pagination",{attrs:{"current-page":t.pageIndex,"page-sizes":[10,15,20,30],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.dataTotal},on:{"size-change":t.pageSizeChange,"current-change":t.pageIndexChange}})],1)],1)],1)],1),t._v(" "),t.dialogPositionAdd?i("el-dialog",{attrs:{title:"新增职位",visible:t.dialogPositionAdd,"append-to-body":"",width:"600px"},on:{"update:visible":function(e){t.dialogPositionAdd=e}}},[i("PositionAdd",{attrs:{pid:t.currentPositionType},on:{closeDialog:t.closeDialog,parentGetDataList:t.getDataList}})],1):t._e(),t._v(" "),t.dialogPositionEdit?i("el-dialog",{attrs:{title:"编辑职位信息",visible:t.dialogPositionEdit,"append-to-body":"",width:"600px"},on:{"update:visible":function(e){t.dialogPositionEdit=e}}},[i("PositionAdd",{attrs:{id:t.editId},on:{closeDialog:t.closeDialog,parentGetDataList:t.getDataList}})],1):t._e()],1)},staticRenderFns:[]};var r=i("Aizv")(s,n,!1,function(t){i("C3Zj")},"data-v-6ab43954",null);e.default=r.exports},lQcN:function(t,e){}});
//# sourceMappingURL=10.c779893d1036d445f046.js.map