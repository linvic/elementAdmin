webpackJsonp([12],{"a/Od":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("3SZ7"),a=i.n(s),n=i("u6qr"),o=i.n(n),l={data:function(){return{step:0,isEdit:!1,stepOne_form:{open_name:"",project_id:"",project_name:"",building_id:"",building_name:"",process_type:""},stepOne_rules:{open_name:[{required:!0,message:"请填写放盘名称/批次",trigger:"blur"}],project_id:[{required:!0,message:"请选择放盘项目",trigger:"change"}],building_id:[{required:!0,message:"请选择放盘楼宇",trigger:"change"}],process_type:[{required:!0,message:"请选择适用销售流程",trigger:"change"}]},checkAll:!1,checkAllIsShow:!0,checkedTr:[],checkedTrAll:[],isIndeterminate:!1,build_name:"",roomMaxLength:0,roomSelected:[],roomList:[],disabled:{is_sale:!0,is_reserve:!0,is_cancel:!0},projects:[],building:[]}},props:{editObj:{type:Object}},created:function(){var e=this;this.$https.all([this.getProjects()]).then(this.$https.spread(function(t,i){e.editObj&&e.setOldData()}))},watch:{checkedTr:function(e,t){var i=this.ArrExcept(e,t);e.length>t.length?this.checkedTrActive(i,!0):e.length<t.length&&this.checkedTrActive(i,!1)},roomList:{handler:function(e,t){var i=!0,s=!1,a=void 0;try{for(var n,l=o()(this.roomList);!(i=(n=l.next()).done);i=!0){var r=n.value,c=0,d=0,p=!0,u=!1,_=void 0;try{for(var h,m=o()(r.rooms);!(p=(h=m.next()).done);p=!0){var g=h.value;if(3!==g.open_status){c++;var f=this.roomSelected.length+1,v=this.roomSelected.indexOf(g,-f);g.active?(d++,-1===v&&this.roomSelected.push(g)):-1!==v&&this.roomSelected.splice(v,1)}}}catch(e){u=!0,_=e}finally{try{!p&&m.return&&m.return()}finally{if(u)throw _}}var b=this.checkedTr.length+1,y=this.checkedTr.indexOf(r.floor_id,-b);c>0&&c===d?-1===y&&this.checkedTr.push(r.floor_id):-1!==y&&this.checkedTr.splice(y,1)}}catch(e){s=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw a}}},deep:!0},roomSelected:function(e,t){if(0===e.length)this.disabled.is_sale=!0,this.disabled.is_reserve=!0,this.disabled.is_cancel=!0;else{this.disabled.is_sale=!1,this.disabled.is_reserve=!1,this.disabled.is_cancel=!1;var i=!0,s=!1,a=void 0;try{for(var n,l=o()(e);!(i=(n=l.next()).done);i=!0){var r=n.value;0===r.open_status?this.disabled.is_cancel=!0:1===r.open_status?this.disabled.is_sale=!0:2===r.open_status&&(this.disabled.is_reserve=!0)}}catch(e){s=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw a}}}},checkedTrAll:function(e,t){console.log("all数据变了",e,t)}},methods:{setOldData:function(){this.stepOne_form.open_name=this.editObj.open_name,this.stepOne_form.project_id=this.editObj.project_id,this.stepOne_form.process_type=this.editObj.process_type.toString();var e=this;this.$https.all([this.getBuildings(this.editObj.project_id)]).then(this.$https.spread(function(t,i){e.stepOne_form.building_id=e.editObj.building_id,e.changeBuilding(e.stepOne_form.building_id),e.isEdit=!0,e.step=1,e.getList()}))},stepOne_next:function(){var e=this;this.$refs.stepOne_form.validate(function(t){if(!t)return console.error("验证不通过"),!1;e.$https.get("/api/pms_sale_open/QueryOpenStatus",{params:{building_id:e.stepOne_form.building_id}}).then(function(t){0==t.data.code?(e.step=1,e.getList()):e.$message({type:"error",showClose:!0,message:t.data.message})})})},handleCheckAllChange:function(e){this.checkedTr=e?this.checkedTrAll:[],this.isIndeterminate=!1},handleCheckedTrChange:function(e){var t=this.checkedTr.length;this.checkAll=t===this.roomList.length,this.isIndeterminate=t>0&&t<this.roomList.length},getList:function(){var e=this;console.log("lou",this.stepOne_form.building_id),this.$https.get("/api/pms_sale_open/GetOpenDetails",{params:{building_id:this.stepOne_form.building_id}}).then(function(t){0==t.data.code?(e.roomList=t.data.data.floors,e.roomMaxLength=t.data.data.floor_max_room,e.build_name=t.data.data.building_name,e.checkedTrAll=[],e.roomList.map(function(t){e.checkedTrAll.push(t.floor_id),t.rooms.map(function(t){e.$set(t,"active",!1),e.isEdit||0!==t.open_status&&(t.open_status=3)})})):e.$message({type:"error",showClose:!0,message:t.data.message})})},checkedRoom:function(e){3!==e.open_status&&(e.active=!e.active)},checkedTrActive:function(e,t){var i=!0,s=!1,a=void 0;try{for(var n,l=o()(e);!(i=(n=l.next()).done);i=!0){var r=n.value,c=!0,d=!1,p=void 0;try{for(var u,_=o()(this.roomList);!(c=(u=_.next()).done);c=!0){var h=u.value;if(r==h.floor_id){var m=!0,g=!1,f=void 0;try{for(var v,b=o()(h.rooms);!(m=(v=b.next()).done);m=!0){var y=v.value;t?3!==y.open_status&&(y.active=!0):3!==y.open_status&&(y.active=!1)}}catch(e){g=!0,f=e}finally{try{!m&&b.return&&b.return()}finally{if(g)throw f}}}}}catch(e){d=!0,p=e}finally{try{!c&&_.return&&_.return()}finally{if(d)throw p}}}}catch(e){s=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw a}}},ArrExcept:function(e,t){for(var i=[],s=e.concat(t),a={},n=0;n<s.length;n++)s[n]in a?a[s[n]]++:a[s[n]]=1;for(var o in a)1==a[o]&&i.push(o);return i},isSale:function(){this.checkAllIsShow=!1;var e=!0,t=!1,i=void 0;try{for(var s,a=o()(this.roomSelected);!(e=(s=a.next()).done);e=!0){var n=s.value;n.open_status=1,n.active=!1}}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}},isReserve:function(){this.checkAllIsShow=!1;var e=!0,t=!1,i=void 0;try{for(var s,a=o()(this.roomSelected);!(e=(s=a.next()).done);e=!0){var n=s.value;n.open_status=2,n.active=!1}}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}},isCancel:function(){this.checkAllIsShow=!1;var e=!0,t=!1,i=void 0;try{for(var s,a=o()(this.roomSelected);!(e=(s=a.next()).done);e=!0){var n=s.value;n.open_status=0,n.active=!1}}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}},stepTwo_save:function(){var e=this;this.$refs.stepOne_form.validate(function(t){if(!t)return console.error("验证不通过"),!1;var i={},s=e;e.roomList.map(function(t){e.checkedTrAll.push(t.floor_id),t.rooms.map(function(e){if(s.isEdit){var t=""+e.room_id;i[t]=e.open_status}else if(1===e.open_status||2===e.open_status){var a=""+e.room_id;i[a]=e.open_status}})});var n=JSON.parse(a()(e.stepOne_form));n.rooms=i,e.isEdit&&(n.open_id=e.editObj.id),e.$https.post("/api/pms_sale_open/CommitOpenStatus",n).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:e.isEdit?"放盘修改成功":"放盘成功",duration:1e3,onClose:function(){e.closeDialog(),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})})},getProjects:function(){var e=this;return this.$https.get("/api/pms_base_projects/GetProjects",{params:{page:1,page_size:999}}).then(function(t){0==t.data.code?(e.projects=t.data.data.Items,console.log("获取了projects")):e.$message({type:"error",showClose:!0,message:t.data.message})})},getBuildings:function(e){var t=this,i=this.projects.find(function(t){return t.project_id===e});return console.log(this.projects),this.stepOne_form.project_name=i.project_name,this.stepOne_form.building_id="",this.$https.get("/api/pms_base_buildings/GetBuildings",{params:{page:1,page_size:999,project_id:this.stepOne_form.project_id}}).then(function(e){0==e.data.code?t.building=e.data.data.Items:t.$message({type:"error",showClose:!0,message:e.data.message})})},changeBuilding:function(e){var t=this.building.find(function(t){return t.building_id===e});this.stepOne_form.building_name=t.building_name},closeDialog:function(e){e?this.$emit("closeDialog",e):(this.$emit("closeDialog","dialogSellingAdd"),this.$emit("closeDialog","dialogSellingEdit"))}},computed:{}},r={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-form",{directives:[{name:"show",rawName:"v-show",value:0===e.step||e.isEdit,expression:"step === 0 || isEdit"}],ref:"stepOne_form",attrs:{model:e.stepOne_form,size:"small","status-icon":"",rules:e.stepOne_rules,"label-width":"130px"}},[i("el-form-item",{attrs:{label:"放盘名称/批次：",prop:"open_name"}},[i("el-input",{model:{value:e.stepOne_form.open_name,callback:function(t){e.$set(e.stepOne_form,"open_name",t)},expression:"stepOne_form.open_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"项目名称：",prop:"project_id"}},[i("el-select",{attrs:{disabled:e.isEdit},on:{change:e.getBuildings},model:{value:e.stepOne_form.project_id,callback:function(t){e.$set(e.stepOne_form,"project_id",t)},expression:"stepOne_form.project_id"}},e._l(e.projects,function(e){return i("el-option",{key:e.project_id,attrs:{label:e.project_name,value:e.project_id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"楼宇名称：",prop:"building_id"}},[i("el-select",{attrs:{disabled:e.isEdit},on:{change:e.changeBuilding},model:{value:e.stepOne_form.building_id,callback:function(t){e.$set(e.stepOne_form,"building_id",t)},expression:"stepOne_form.building_id"}},e._l(e.building,function(e){return i("el-option",{key:e.building_id,attrs:{label:e.building_name,value:e.building_id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"适用销售流程：",prop:"process_type"}},[i("el-select",{model:{value:e.stepOne_form.process_type,callback:function(t){e.$set(e.stepOne_form,"process_type",t)},expression:"stepOne_form.process_type"}},[i("el-option",{attrs:{label:"产业楼销售流程",value:"0"}}),e._v(" "),i("el-option",{attrs:{label:"住宅楼销售流程",value:"1"}})],1)],1),e._v(" "),i("el-form-item",[e.isEdit?e._e():i("el-button",{on:{click:function(t){e.stepOne_next()}}},[e._v("下一步")])],1)],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:1===e.step||e.isEdit,expression:"step === 1 || isEdit"}]},[i("div",{staticClass:"selling_rooms"},[e._m(0),e._v(" "),i("div",{staticClass:"selling_rooms_list"},[i("table",{staticClass:"selling_table"},[i("thead",[i("tr",[i("th",[i("el-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.checkAllIsShow,expression:"checkAllIsShow"}],attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")])],1),e._v(" "),i("th",{attrs:{colspan:"999"}},[e._v(e._s(e.build_name))])])]),e._v(" "),i("tbody",e._l(e.roomList,function(t){return i("tr",[i("td",[i("el-checkbox",{key:t.floor_id,attrs:{label:t.floor_id,name:"floor"},on:{change:e.handleCheckedTrChange},model:{value:e.checkedTr,callback:function(t){e.checkedTr=t},expression:"checkedTr"}},[e._v(e._s(t.floor_name))])],1),e._v(" "),e._l(t.rooms,function(t){return i("td",{class:{active:!0===t.active,room:3!==t.open_status,status0:0===t.open_status,status1:1===t.open_status,status2:2===t.open_status,disabled:3===t.open_status},on:{click:function(i){e.checkedRoom(t)}}},[i("p",[e._v(e._s(t.room_name))]),e._v(" "),i("em",[e._v("￥"+e._s(t.guide_price))])])}),e._v(" "),e._l(e.roomMaxLength-t.rooms.length,function(e){return i("td")})],2)}))])])]),e._v(" "),i("div",{staticClass:"m-t"},[i("el-button",{attrs:{size:"mini",type:"primary",plain:"",disabled:e.disabled.is_sale},on:{click:function(t){e.isSale()}}},[e._v("标记为可售")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"success",plain:"",disabled:e.disabled.is_reserve},on:{click:function(t){e.isReserve()}}},[e._v("标记为预留")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"warning",plain:"",disabled:e.disabled.is_cancel},on:{click:function(t){e.isCancel()}}},[e._v("取消放盘")])],1),e._v(" "),i("div",{staticClass:"m-t"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.stepTwo_save()}}},[e._v("保存并发布放盘")])],1)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("ul",{staticClass:"statusTag"},[t("li",[t("i",{staticClass:"el-icon-web-stop",staticStyle:{color:"#fff"}}),this._v(" 未放盘")]),this._v(" "),t("li",[t("i",{staticClass:"el-icon-web-stop",staticStyle:{color:"#ddd"}}),this._v(" 已放盘")]),this._v(" "),t("li",[t("i",{staticClass:"el-icon-web-stop",staticStyle:{color:"#409EFF"}}),this._v(" 可售")]),this._v(" "),t("li",[t("i",{staticClass:"el-icon-web-stop",staticStyle:{color:"#67c23a"}}),this._v(" 预留")])])}]};var c={components:{SellingAdd:i("Aizv")(l,r,!1,function(e){i("jLcT")},"data-v-bf4892e4",null).exports},data:function(){return{editObjs:null,pageIndex:1,pageSize:10,dataTotal:0,loading:!0,tableData:[],dialogSellingAdd:!1,dialogSellingEdit:!1}},created:function(){this.getDataList()},watch:{},methods:{closeDialog:function(e){this[e]=!1},pageSizeChange:function(e){this.pageSize=e,this.getDataList()},pageIndexChange:function(e){this.pageIndex=e,this.getDataList()},getDataList:function(){var e=this;this.$https.get("/api/pms_sale_open/GetRecords",{params:{page:this.pageIndex,page_size:this.pageSize}}).then(function(t){0==t.data.code?(e.tableData=t.data.data.Items,e.dataTotal=t.data.data.Total,e.loading=!1):e.$message({type:"error",showClose:!0,message:t.data.message})})},sellingEdit:function(e){this.editObjs={id:e.open_id,open_name:e.open_name,project_id:e.project_id,building_id:e.building_id,process_type:e.process_type},this.dialogSellingEdit=!0}}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-card",[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[e._v("放盘记录")]),e._v(" "),i("el-button-group",{staticStyle:{float:"right"}},[i("el-button",{attrs:{size:"small",onclick:"window.location.reload()",icon:"el-icon-refresh"}},[e._v("刷新")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){e.dialogSellingAdd=!0}}},[e._v("新增")])],1)],1),e._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[i("el-table-column",{attrs:{prop:"open_id",label:"ID",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{prop:"open_name",label:"放盘名称/批次"}}),e._v(" "),i("el-table-column",{attrs:{prop:"project_name",label:"项目名称"}}),e._v(" "),i("el-table-column",{attrs:{prop:"building_name",label:"楼宇名称"}}),e._v(" "),i("el-table-column",{attrs:{label:"适用销售流程"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(0===t.row.process_type?"产业楼销售流程":"住宅楼销售流程")+"\n                ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"open_area",label:"放盘面积(平方米)"}}),e._v(" "),i("el-table-column",{attrs:{prop:"created_time",label:"创建时间"}}),e._v(" "),i("el-table-column",{attrs:{label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s("0001-01-01 00:00:00"===t.row.modify_time?"":t.row.modify_time)+"\n                ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",type:"success",plain:""},on:{click:function(i){e.See(t.row.open_id)}}},[e._v("查看")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(i){e.sellingEdit(t.row)}}},[e._v("修改")])]}}])})],1),e._v(" "),i("div",{staticClass:"text-center m-t"},[i("el-pagination",{attrs:{"current-page":e.pageIndex,"page-sizes":[10,15,20,30],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.dataTotal},on:{"size-change":e.pageSizeChange,"current-change":e.pageIndexChange}})],1)],1),e._v(" "),e.dialogSellingAdd?i("el-dialog",{attrs:{title:"新增放盘",visible:e.dialogSellingAdd,"append-to-body":"",width:"840px"},on:{"update:visible":function(t){e.dialogSellingAdd=t}}},[i("SellingAdd",{on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogSellingEdit?i("el-dialog",{attrs:{title:"修改放盘",visible:e.dialogSellingEdit,"append-to-body":"",width:"840px"},on:{"update:visible":function(t){e.dialogSellingEdit=t}}},[i("SellingAdd",{attrs:{editObj:e.editObjs},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e()],1)},staticRenderFns:[]};var p=i("Aizv")(c,d,!1,function(e){i("zipR")},"data-v-20dd3d4c",null);t.default=p.exports},jLcT:function(e,t){},zipR:function(e,t){}});
//# sourceMappingURL=12.7506fc2426d33b3d4beb.js.map