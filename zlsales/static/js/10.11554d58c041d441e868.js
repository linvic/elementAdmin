webpackJsonp([10],{"7QT1":function(e,t){},Sll4:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("u6qr"),a=i.n(o),n=i("3SZ7"),s=i.n(n),r={components:{ContactsAdd:i("BGwB").a},data:function(){var e=this;return{form:{theme:"",classification:[],customer_source:"",purchase_intention:"",customer_name:"",telephone:"",enterprise_name:"",job:"",intentional_area:"",company_email:"",communication_address:""},form_rules:{classification:[{type:"array",required:!0,message:"请至少选择一个分类",trigger:"change"}],customer_source:[{required:!0,message:"请选择线索来源",trigger:"change"}],purchase_intention:[{required:!0,message:"请选择购买意向",trigger:"change"}],customer_name:[{required:!0,message:"客户姓名不能为空",trigger:"blur"}],telephone:[{required:!0,message:"联系电话不能为空",trigger:"blur"},{validator:function(t,i,o){!e.id&&i?e.$https.get("/api/Customer/get_model_by_telephone?telephone="+e.form.telephone).then(function(t){if(0==t.data.code){o(new Error("联系号码已存在"));var i=t.data.data.c_id,a=t.data.data.user_id;e.$confirm("联系号码已存在"+(t.data.data.user_name?", 此客户现归属于业务员（"+t.data.data.user_name+"）":"")+"，您可申请仲裁","提示",{confirmButtonText:"申请仲裁",cancelButtonText:"取消",type:"warning"}).then(function(){var t=[{c_id:i,old_user_id:a,apply_remark:"线索新增时申请仲裁"}];e.$https.post("/api/customer_change_salesman/create_customer_change_salesman",t).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"申请成功",duration:1500,onClose:function(){e.closeDialog(),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})}).catch(function(){})}else o()}):o()},trigger:"blur"}]},dialogContactsAdd:!1,ContactsList:[],classification:[],customer_source:[],purchase_intention:[]}},props:{id:{type:Number}},created:function(){var e=this;this.$https.all([this.getDic("crm_classification","classification"),this.getDic("crm_customer_source","customer_source"),this.getDic("crm_purchase_intention","purchase_intention")]).then(this.$https.spread(function(t,i){e.id&&(e.getOldData(),e.getContactsList())}))},watch:{},methods:{setContactsList:function(e){var t=this,i=JSON.parse(e);this.id?(i.c_id=this.id,this.$https.post("/api/customer_linkman/create_customer_linkman",i).then(function(e){0==e.data.code?t.getContactsList():t.$message({type:"error",showClose:!0,message:e.data.message})})):this.ContactsList.push(i)},closeTag:function(e,t){var i=this;this.id?this.$https.get("/api/customer_linkman/delete_customer_linkman?cl_id="+e.cl_id+"&c_id="+this.id).then(function(e){0==e.data.code?i.$message({type:"success",showClose:!0,message:"联系人删除成功",duration:1e3,onClose:function(){i.getContactsList()}}):i.$message({type:"error",showClose:!0,message:e.data.message})}):this.ContactsList.splice(t,1)},closeThisDialog:function(e){this[e]=!1},getOldData:function(){var e=this;this.$https.get("/api/Customer/get_customerdetails?c_id="+this.id).then(function(t){if(0==t.data.code){var i=t.data.data;e.form.theme=i.theme,e.form.classification=i.classification.split(","),e.form.customer_source=i.customer_source,e.form.purchase_intention=i.purchase_intention,e.form.customer_name=i.customer_name,e.form.telephone=i.telephone,e.form.enterprise_name=i.enterprise_name,e.form.job=i.job,e.form.intentional_area=0==i.intentional_area?"":i.intentional_area,e.form.company_email=i.company_email,e.form.communication_address=i.communication_address,console.log(e.form)}else e.$message({type:"error",showClose:!0,message:t.data.message})})},getContactsList:function(){var e=this;this.$https.get("/api/customer_linkman/list_customer_linkman?c_id="+this.id).then(function(t){0==t.data.code?e.ContactsList=t.data.data:e.$message({type:"error",showClose:!0,message:t.data.message})})},existCompany:function(){var e=this;this.$https.get("/api/Customer/exist_by_enterprise_name?enterprise_name="+this.form.enterprise_name).then(function(t){0==t.data.code&&e.$alert("此公司名称已存在，如有需要可向总监申请仲裁","提醒",{confirmButtonText:"知道了"})})},submit:function(){var e=this;console.log("提交"),this.$refs.form.validate(function(t){if(!t)return console.error("验证失败"),!1;var i=JSON.parse(s()(e.form));i.classification=e.form.classification.join(","),i.intentional_area=""==e.form.intentional_area?0:e.form.intentional_area,e.id?(i.c_id=parseInt(e.id),e.$https.post("/api/Customer/update_customer_clue",i).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"编辑成功",duration:1500,onClose:function(){e.closeDialog("dialogCluesEdit"),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})):(i.list_customer_linkman=e.ContactsList,e.$https.post("/api/Customer/create_customer_clue",i).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"添加成功",duration:1500,onClose:function(){e.closeDialog("dialogCluesAdd"),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})}))})},getDic:function(e,t){var i=this;this.$https.get("/api/Dicts/GetValues",{params:{type_code:e}}).then(function(e){0==e.data.code?i[t]=e.data.data:i.$message({type:"error",showClose:!0,message:e.data.message})})},closeDialog:function(e){e?this.$emit("closeDialog",e):(this.$emit("closeDialog","dialogCluesAdd"),this.$emit("closeDialog","dialogCluesEdit"))}}},l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-form",{ref:"form",attrs:{rules:e.form_rules,model:e.form,"label-width":"120px",size:"small"}},[i("el-form-item",{attrs:{label:"线索名称/主题"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.theme,callback:function(t){e.$set(e.form,"theme",t)},expression:"form.theme"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"线索分类",prop:"classification"}},[i("el-checkbox-group",{model:{value:e.form.classification,callback:function(t){e.$set(e.form,"classification",t)},expression:"form.classification"}},e._l(e.classification,function(t){return i("el-checkbox",{key:t.value_id,attrs:{label:String(t.value_id),name:"type"}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),i("el-form-item",{attrs:{label:"线索来源",prop:"customer_source"}},[i("el-radio-group",{model:{value:e.form.customer_source,callback:function(t){e.$set(e.form,"customer_source",t)},expression:"form.customer_source"}},e._l(e.customer_source,function(t){return i("el-radio",{key:t.value_id,attrs:{label:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),i("el-form-item",{attrs:{label:"购买意向",prop:"purchase_intention"}},[i("el-radio-group",{model:{value:e.form.purchase_intention,callback:function(t){e.$set(e.form,"purchase_intention",t)},expression:"form.purchase_intention"}},e._l(e.purchase_intention,function(t){return i("el-radio",{key:t.value_id,attrs:{label:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),i("el-form-item",{attrs:{label:"客户姓名",prop:"customer_name"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.customer_name,callback:function(t){e.$set(e.form,"customer_name",t)},expression:"form.customer_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"客户联系电话",prop:"telephone"}},[i("el-input",{attrs:{placeholder:"请输入",disabled:void 0!==e.id},model:{value:e.form.telephone,callback:function(t){e.$set(e.form,"telephone",t)},expression:"form.telephone"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"企业名称"}},[i("el-input",{attrs:{placeholder:"请输入"},on:{blur:function(t){e.existCompany()}},model:{value:e.form.enterprise_name,callback:function(t){e.$set(e.form,"enterprise_name",t)},expression:"form.enterprise_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"职务"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.job,callback:function(t){e.$set(e.form,"job",t)},expression:"form.job"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"意向面积"}},[i("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"数字，小数点两位，单位平方米",type:"number"},nativeOn:{keyup:function(t){e.onkeyupPrice(t)}},model:{value:e.form.intentional_area,callback:function(t){e.$set(e.form,"intentional_area",t)},expression:"form.intentional_area"}}),e._v(" 平米\n        ")],1),e._v(" "),i("el-form-item",{attrs:{label:"电子邮箱"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.company_email,callback:function(t){e.$set(e.form,"company_email",t)},expression:"form.company_email"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"通讯地址"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.communication_address,callback:function(t){e.$set(e.form,"communication_address",t)},expression:"form.communication_address"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"联系人"}},[e._l(e.ContactsList,function(t,o){return i("el-tag",{key:o,attrs:{type:"success",closable:"","disable-transitions":!1},on:{close:function(i){e.closeTag(t,o)}}},[e._v("\n                "+e._s(t.linkman_name)+"\n            ")])}),e._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-web-add",plain:""},on:{click:function(t){e.dialogContactsAdd=!0}}},[e._v("新增联系人")])],2),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("保存")]),e._v(" "),i("el-button",{on:{click:function(t){e.closeDialog()}}},[e._v("取消")])],1)],1),e._v(" "),e.dialogContactsAdd?i("el-dialog",{attrs:{title:"新增联系人",visible:e.dialogContactsAdd,"append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.dialogContactsAdd=t}}},[i("ContactsAdd",{on:{closeThisDialog:e.closeThisDialog,parentSetContactsList:e.setContactsList}})],1):e._e()],1)},staticRenderFns:[]};var c=i("Aizv")(r,l,!1,function(e){i("quA1")},"data-v-38351182",null).exports,m=i("5BUm"),u={data:function(){return{step:0,form:{theme:"",classification:[],purchase_intention:"",customer_name:"",telephone:"",intentional_area:"",customer_type:1,person_identification_type:"",person_identification_number:"",enterprise_name:"",company_identification_type:"",company_identification_number:""},rawform:{person_identification_type:"",person_identification_number:"",enterprise_name:"",company_identification_type:"",company_identification_number:""},form_rules:{classification:[{type:"array",required:!0,message:"请至少选择一个分类",trigger:"change"}],purchase_intention:[{required:!0,message:"请选择购买意向",trigger:"change"}],customer_name:[{required:!0,message:"客户姓名不能为空",trigger:"blur"}],customer_type:[{required:!0,message:"请选择客户类别",trigger:"change"}]},classification:[],purchase_intention:[],identification_type:[],company_card_type:[],flowForm:{flow_id:"1",customer_type:1,person_identification_type:"",person_identification_number:"",enterprise_name:"",company_identification_type:"",company_identification_number:""},flowForm_rules:{flow_id:[{required:!0,message:"请选择适用流程",trigger:"change"}],customer_type:[{required:!0,message:"请选择客户类别",trigger:"change"}]}}},props:{id:{type:Number}},created:function(){var e=this;this.$https.all([this.getDic("crm_classification","classification"),this.getDic("crm_purchase_intention","purchase_intention"),this.getDic("contact_card_type","identification_type"),this.getDic("company_card_type","company_card_type")]).then(this.$https.spread(function(t,i){console.log(e.id),e.id&&e.getOldData()}))},methods:{closeThisDialog:function(e){this[e]=!1},getOldData:function(){var e=this;this.$https.get("/api/Customer/get_customerdetails?c_id="+this.id).then(function(t){if(0==t.data.code){var i=t.data.data;e.form.theme=i.theme,e.form.classification=i.classification.split(","),e.form.purchase_intention=i.purchase_intention,e.form.customer_name=i.customer_name,e.form.telephone=i.telephone,e.form.intentional_area=0==i.intentional_area?"":i.intentional_area,e.form.enterprise_name=i.enterprise_name,e.form.company_identification_type=i.company_identification_type,e.form.company_identification_number=i.company_identification_number,e.form.person_identification_type=i.person_identification_type,e.form.person_identification_number=i.person_identification_number,e.rawform.enterprise_name=i.enterprise_name,e.rawform.company_identification_type=i.company_identification_type,e.rawform.company_identification_number=i.company_identification_number,e.rawform.person_identification_type=i.person_identification_type,e.rawform.person_identification_number=i.person_identification_number}else e.$message({type:"error",showClose:!0,message:t.data.message})})},next:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return console.error("验证失败"),!1;var i=JSON.parse(s()(e.form));if(i.c_id=parseInt(e.id),1==i.customer_type){if(""==i.person_identification_type)return void e.$message({type:"error",showClose:!0,message:"请选择个人证件类型"});if(""==i.person_identification_number)return void e.$message({type:"error",showClose:!0,message:"请填写个人证件号码"});i.enterprise_name=e.rawform.enterprise_name,i.company_identification_type=e.rawform.company_identification_type,i.company_identification_number=e.rawform.company_identification_number}else{if(""==i.enterprise_name)return void e.$message({type:"error",showClose:!0,message:"请填写企业名称"});if(""==i.company_identification_type)return void e.$message({type:"error",showClose:!0,message:"请选择企业证件类型"});if(""==i.company_identification_number)return void e.$message({type:"error",showClose:!0,message:"请填写企业证件号码"});i.person_identification_type=e.rawform.person_identification_type,i.person_identification_number=e.rawform.person_identification_number}i.classification=e.form.classification.join(","),i.intentional_area=""==e.form.intentional_area?0:e.form.intentional_area,e.$https.post("/api/Customer/update_customer_clue_to_sale",i).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"已成功将该客户转换为机会客户，请继续为改客户创建一个销售流程",duration:1500,onClose:function(){e.step=1,e.flowForm.customer_type=i.customer_type,e.flowForm.enterprise_name=i.enterprise_name,e.flowForm.company_identification_type=i.company_identification_type,e.flowForm.company_identification_number=i.company_identification_number,e.flowForm.person_identification_type=i.person_identification_type,e.flowForm.person_identification_number=i.person_identification_number}}):e.$message({type:"error",showClose:!0,message:t.data.message})})})},getDic:function(e,t){var i=this;this.$https.get("/api/Dicts/GetValues",{params:{type_code:e}}).then(function(e){0==e.data.code?i[t]=e.data.data:i.$message({type:"error",showClose:!0,message:e.data.message})})},closeDialog:function(e){e?this.$emit("closeDialog",e):this.$emit("closeDialog","dialogCluesToChance")},submit:function(){var e=this;this.$refs.flowForm.validate(function(t){if(!t)return console.error("验证失败"),!1;var i={flow_id:e.flowForm.flow_id};if(i.customer_transaction_model={c_id:e.id,transaction_type:2,transaction_status:0,customer_type:e.flowForm.customer_type,person_identification_type:e.flowForm.person_identification_type,person_identification_number:e.flowForm.person_identification_number,enterprise_name:e.flowForm.enterprise_name,company_identification_type:e.flowForm.company_identification_type,company_identification_number:e.flowForm.company_identification_number},1==i.customer_transaction_model.customer_type){if(""==i.customer_transaction_model.person_identification_type)return void e.$message({type:"error",showClose:!0,message:"请选择个人证件类型"});if(""==i.customer_transaction_model.person_identification_number)return void e.$message({type:"error",showClose:!0,message:"请填写个人证件号码"});i.customer_transaction_model.enterprise_name=e.rawform.enterprise_name,i.customer_transaction_model.company_identification_type=e.rawform.company_identification_type,i.customer_transaction_model.company_identification_number=e.rawform.company_identification_number}else{if(""==i.customer_transaction_model.enterprise_name)return void e.$message({type:"error",showClose:!0,message:"请填写企业名称"});if(""==i.customer_transaction_model.company_identification_type)return void e.$message({type:"error",showClose:!0,message:"请选择企业证件类型"});if(""==i.customer_transaction_model.company_identification_number)return void e.$message({type:"error",showClose:!0,message:"请填写企业证件号码"});i.customer_transaction_model.person_identification_type=e.rawform.person_identification_type,i.customer_transaction_model.person_identification_number=e.rawform.person_identification_number}e.$https.post("/api/flow_buyinghouse/create_flow_buyinghouse",i).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"已为该客户成功创建销售流程",duration:1500,onClose:function(){e.closeDialog(),e.$emit("parentGetDataList")}}):e.$message({type:"error",showClose:!0,message:t.data.message})})})}}},_={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[0===e.step?i("el-form",{ref:"form",attrs:{rules:e.form_rules,model:e.form,"label-width":"120px",size:"small"}},[i("el-form-item",{attrs:{label:"购买意向",prop:"purchase_intention"}},[i("el-radio-group",{model:{value:e.form.purchase_intention,callback:function(t){e.$set(e.form,"purchase_intention",t)},expression:"form.purchase_intention"}},e._l(e.purchase_intention,function(t){return i("el-radio",{key:t.value_id,attrs:{label:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),i("el-form-item",{attrs:{label:"线索分类",prop:"classification"}},[i("el-checkbox-group",{model:{value:e.form.classification,callback:function(t){e.$set(e.form,"classification",t)},expression:"form.classification"}},e._l(e.classification,function(t){return i("el-checkbox",{key:t.value_id,attrs:{label:String(t.value_id),name:"type"}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),i("el-form-item",{attrs:{label:"线索名称/主题"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.theme,callback:function(t){e.$set(e.form,"theme",t)},expression:"form.theme"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"客户姓名",prop:"customer_name"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.customer_name,callback:function(t){e.$set(e.form,"customer_name",t)},expression:"form.customer_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"客户联系电话"}},[i("p",[e._v(e._s(e.form.telephone))])]),e._v(" "),i("el-form-item",{attrs:{label:"意向面积"}},[i("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"数字，小数点两位，单位平方米",type:"number"},nativeOn:{keyup:function(t){e.onkeyupPrice(t)}},model:{value:e.form.intentional_area,callback:function(t){e.$set(e.form,"intentional_area",t)},expression:"form.intentional_area"}}),e._v(" 平米\n        ")],1),e._v(" "),i("el-form-item",{attrs:{label:"客户主体类别",prop:"customer_type"}},[i("el-radio-group",{model:{value:e.form.customer_type,callback:function(t){e.$set(e.form,"customer_type",t)},expression:"form.customer_type"}},[i("el-radio",{attrs:{label:1}},[e._v("个人")]),e._v(" "),i("el-radio",{attrs:{label:2}},[e._v("企业")])],1)],1),e._v(" "),1==e.form.customer_type?i("div",[i("el-form-item",{attrs:{label:"个人证件类型"}},[i("el-select",{model:{value:e.form.person_identification_type,callback:function(t){e.$set(e.form,"person_identification_type",t)},expression:"form.person_identification_type"}},e._l(e.identification_type,function(t){return i("el-option",{key:t.value_id,attrs:{label:t.value_name,value:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),i("el-form-item",{attrs:{label:"个人证件号码",prop:"person_identification_number"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.person_identification_number,callback:function(t){e.$set(e.form,"person_identification_number",t)},expression:"form.person_identification_number"}})],1)],1):e._e(),e._v(" "),2==e.form.customer_type?i("div",[i("el-form-item",{attrs:{label:"企业名称"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.enterprise_name,callback:function(t){e.$set(e.form,"enterprise_name",t)},expression:"form.enterprise_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"企业证件类型"}},[i("el-select",{model:{value:e.form.company_identification_type,callback:function(t){e.$set(e.form,"company_identification_type",t)},expression:"form.company_identification_type"}},e._l(e.company_card_type,function(t){return i("el-option",{key:t.value_id,attrs:{label:t.value_name,value:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),i("el-form-item",{attrs:{label:"企业证件号码"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.company_identification_number,callback:function(t){e.$set(e.form,"company_identification_number",t)},expression:"form.company_identification_number"}})],1)],1):e._e(),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.next()}}},[e._v("下一步，创建销售流程")]),e._v(" "),i("el-button",{on:{click:function(t){e.closeDialog()}}},[e._v("取消")])],1)],1):e._e(),e._v(" "),1===e.step?i("el-form",{ref:"flowForm",attrs:{rules:e.flowForm_rules,model:e.flowForm,"label-width":"120px",size:"small"}},[i("el-form-item",{attrs:{label:"适用销售流程",prop:"flow_id"}},[i("el-select",{model:{value:e.flowForm.flow_id,callback:function(t){e.$set(e.flowForm,"flow_id",t)},expression:"flowForm.flow_id"}},[i("el-option",{attrs:{label:"测试值为1",value:"1"}})],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"客户主体类别",prop:"customer_type"}},[i("el-radio-group",{model:{value:e.flowForm.customer_type,callback:function(t){e.$set(e.flowForm,"customer_type",t)},expression:"flowForm.customer_type"}},[i("el-radio",{attrs:{label:1}},[e._v("个人")]),e._v(" "),i("el-radio",{attrs:{label:2}},[e._v("企业")])],1)],1),e._v(" "),1==e.flowForm.customer_type?i("div",[i("el-form-item",{attrs:{label:"个人证件类型"}},[i("el-select",{model:{value:e.flowForm.person_identification_type,callback:function(t){e.$set(e.flowForm,"person_identification_type",t)},expression:"flowForm.person_identification_type"}},e._l(e.identification_type,function(t){return i("el-option",{key:t.value_id,attrs:{label:t.value_name,value:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),i("el-form-item",{attrs:{label:"个人证件号码",prop:"person_identification_number"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.flowForm.person_identification_number,callback:function(t){e.$set(e.flowForm,"person_identification_number",t)},expression:"flowForm.person_identification_number"}})],1)],1):e._e(),e._v(" "),2==e.flowForm.customer_type?i("div",[i("el-form-item",{attrs:{label:"企业名称"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.flowForm.enterprise_name,callback:function(t){e.$set(e.flowForm,"enterprise_name",t)},expression:"flowForm.enterprise_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"企业证件类型"}},[i("el-select",{model:{value:e.flowForm.company_identification_type,callback:function(t){e.$set(e.flowForm,"company_identification_type",t)},expression:"flowForm.company_identification_type"}},e._l(e.company_card_type,function(t){return i("el-option",{key:t.value_id,attrs:{label:t.value_name,value:String(t.value_id)}},[e._v(e._s(t.value_name))])}))],1),e._v(" "),i("el-form-item",{attrs:{label:"企业证件号码"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.flowForm.company_identification_number,callback:function(t){e.$set(e.flowForm,"company_identification_number",t)},expression:"flowForm.company_identification_number"}})],1)],1):e._e(),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit()}}},[e._v("提交")])],1)],1):e._e()],1)},staticRenderFns:[]};var p=i("Aizv")(u,_,!1,function(e){i("7QT1")},"data-v-bbf55818",null).exports,d=i("ie+Y"),f=i("zGNL"),h={components:{CluesAdd:c,FollowUp:m.a,CluesToChance:p,ChangeSalesman:d.a,Details:f.a},data:function(){return{editId:null,FollowUpObj:null,pageIndex:1,pageSize:10,dataTotal:0,loading:!0,formFilter:{enterprise_name:"",customer_name:"",telephone:"",theme:"",user_id:"-2",purchase_intention:""},searchForm:{enterprise_name:"",customer_name:"",telephone:"",theme:""},selectionChecked:[],tableData:[],classification:[],purchase_intention:[],roleunitUsers:[],dialogCluesAdd:!1,dialogCluesEdit:!1,dialogDetails:!1,dialogFollowUp:!1,dialogChangeSalesman:!1,dialogCluesToChance:!1}},created:function(){this.$https.all([this.getDic("crm_classification","classification"),this.getDic("crm_purchase_intention","purchase_intention"),this.getRoleunitUsers(),this.getDataList()]).then(this.$https.spread(function(e,t){}))},watch:{"formFilter.purchase_intention":function(){this.getDataList()},"formFilter.user_id":function(){this.getDataList()}},methods:{pageSizeChange:function(e){this.pageSize=e,this.getDataList()},pageIndexChange:function(e){this.pageIndex=e,this.getDataList()},closeDialog:function(e){this[e]=!1},cluesEdit:function(e){this.editId=Number(e),this.dialogCluesEdit=!0},openDetails:function(e){this.editId=Number(e),this.dialogDetails=!0},FollowUp:function(e,t,i){this.FollowUpObj={id:Number(e),name:t,type:i},this.dialogFollowUp=!0},cluesToChance:function(e){this.editId=Number(e),this.dialogCluesToChance=!0},getDic:function(e,t){var i=this;this.$https.get("/api/Dicts/GetValues",{params:{type_code:e}}).then(function(e){0==e.data.code?i[t]=e.data.data:i.$message({type:"error",showClose:!0,message:e.data.message})})},getDicVal:function(e,t){var i="",o=!0,n=!1,s=void 0;try{for(var r,l=a()(this[t]);!(o=(r=l.next()).done);o=!0){var c=r.value;e==c.value_id&&(i=c.value_name)}}catch(e){n=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(n)throw s}}return i},getDicVals:function(e,t){var i=[],o=e.split(","),n=!0,s=!1,r=void 0;try{for(var l,c=a()(o);!(n=(l=c.next()).done);n=!0){var m=l.value,u=!0,_=!1,p=void 0;try{for(var d,f=a()(this[t]);!(u=(d=f.next()).done);u=!0){var h=d.value;m==h.value_id&&i.push(h.value_name)}}catch(e){_=!0,p=e}finally{try{!u&&f.return&&f.return()}finally{if(_)throw p}}}}catch(e){s=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(s)throw r}}return i.join(", ")},handleSelectionChange:function(e){this.selectionChecked=e,console.info(this.selectionChecked)},formFilterSubmit:function(){this.searchForm.enterprise_name=this.formFilter.enterprise_name,this.searchForm.customer_name=this.formFilter.customer_name,this.searchForm.telephone=this.formFilter.telephone,this.searchForm.theme=this.formFilter.theme,this.getDataList()},crmDel:function(){var e=this;0===this.selectionChecked.length?this.$message({type:"error",showClose:!0,message:"您未勾选需要删除的客户"}):this.$prompt("请输入删除原因","删除需要总监确认。您还可以将其丢入公海",{inputType:"textarea",confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(t){var i=t.value,o=[],n=!0,s=!1,r=void 0;try{for(var l,c=a()(e.selectionChecked);!(n=(l=c.next()).done);n=!0){var m=l.value,u={c_id:m.c_id,old_user_id:m.user_id,apply_remark:i};o.push(u)}}catch(e){s=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(s)throw r}}e.$https.post("/api/customer_delete_approve/create_customer_delete_approve",o).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"删除成功",duration:1500,onClose:function(){e.getDataList()}}):e.$message({type:"error",showClose:!0,message:t.data.message})})})},crmToPublic:function(){var e=this;if(0===this.selectionChecked.length)this.$message({type:"error",showClose:!0,message:"您未勾选需要丢入公海的客户"});else{var t=[],i=!0,o=!1,n=void 0;try{for(var s,r=a()(this.selectionChecked);!(i=(s=r.next()).done);i=!0){var l=s.value,c={c_id:l.c_id,user_id:l.user_id};t.push(c)}}catch(e){o=!0,n=e}finally{try{!i&&r.return&&r.return()}finally{if(o)throw n}}this.$https.post("/api/Customer/update_customer_to_public",t).then(function(t){0==t.data.code?e.$message({type:"success",showClose:!0,message:"已将选中客户转入公海",duration:1500,onClose:function(){e.getDataList()}}):e.$message({type:"error",showClose:!0,message:t.data.message})})}},changeSalesman:function(){0===this.selectionChecked.length?this.$message({type:"error",showClose:!0,message:"您未勾选需要变更业务员的客户"}):this.dialogChangeSalesman=!0},cluesDemand:function(e){this.$message({type:"error",showClose:!0,message:"敬请期待"})},getRoleunitUsers:function(){var e=this;this.$https.get("/api/Account/list_users_by_roleunit").then(function(t){if(0==t.data.code){var i=!0,o=!1,n=void 0;try{for(var s,r=a()(t.data.data);!(i=(s=r.next()).done);i=!0){var l=s.value,c={id:l.user_id,name:l.user_name};e.roleunitUsers.push(c)}}catch(e){o=!0,n=e}finally{try{!i&&r.return&&r.return()}finally{if(o)throw n}}}else e.$message({type:"error",showClose:!0,message:t.data.message})})},getDataList:function(){var e=this;this.$https.get("/api/Customer/page",{params:{currentPage:this.pageIndex,pageSize:this.pageSize,customer_classify:0,enterprise_name:this.searchForm.enterprise_name,customer_name:this.searchForm.customer_name,telephone:this.searchForm.telephone,theme:this.searchForm.theme,user_id:""==this.formFilter.user_id?"-2":this.formFilter.user_id,purchase_intention:this.formFilter.purchase_intention}}).then(function(t){0==t.data.code?(e.tableData=t.data.data.Items,e.dataTotal=t.data.data.Total,e.loading=!1):e.$message({type:"error",showClose:!0,message:t.data.message})})}}},g={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-card",[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[e._v("我的线索客户")]),e._v(" "),i("el-button-group",{staticStyle:{float:"right"}},[i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini",plain:"",onclick:"window.location.reload()"}},[e._v("刷新")])],1)],1),e._v(" "),i("el-form",{staticClass:"clues_form_seach",attrs:{inline:!0,model:e.formFilter,size:"small"}},[i("el-form-item",{attrs:{label:"公司名称"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formFilter.enterprise_name,callback:function(t){e.$set(e.formFilter,"enterprise_name",t)},expression:"formFilter.enterprise_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"联系人姓名"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formFilter.customer_name,callback:function(t){e.$set(e.formFilter,"customer_name",t)},expression:"formFilter.customer_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"联系电话"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formFilter.telephone,callback:function(t){e.$set(e.formFilter,"telephone",t)},expression:"formFilter.telephone"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"主题"}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formFilter.theme,callback:function(t){e.$set(e.formFilter,"theme",t)},expression:"formFilter.theme"}})],1),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.formFilterSubmit}},[e._v("查询")])],1)],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:18}},[i("el-button",{attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(t){e.crmDel()}}},[e._v("删除")]),e._v(" "),i("el-button",{attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(t){e.crmToPublic()}}},[e._v("丢公海")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"info",icon:"el-icon-web-loop"},on:{click:function(t){e.changeSalesman()}}},[e._v("变更业务员")]),e._v(" "),i("el-select",{staticStyle:{width:"150px","margin-left":"20px","vertical-align":"middle"},attrs:{size:"small",placeholder:"请选择业务员"},model:{value:e.formFilter.user_id,callback:function(t){e.$set(e.formFilter,"user_id",t)},expression:"formFilter.user_id"}},[i("el-option",{attrs:{label:"本人",value:"-2"}}),e._v(" "),e._l(e.roleunitUsers,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})],2),e._v(" "),i("el-select",{staticStyle:{width:"150px","vertical-align":"middle"},attrs:{size:"small",placeholder:"请选择购买意向"},model:{value:e.formFilter.purchase_intention,callback:function(t){e.$set(e.formFilter,"purchase_intention",t)},expression:"formFilter.purchase_intention"}},[i("el-option",{attrs:{label:"所有购买意向",value:""}}),e._v(" "),e._l(e.purchase_intention,function(e){return i("el-option",{key:e.value_id,attrs:{label:e.value_name,value:e.value_id}})})],2)],1),e._v(" "),i("el-col",{staticClass:"text-right",attrs:{span:6}},[i("el-button",{attrs:{size:"small",type:"success",onclick:"alert('敬请期待')",icon:"el-icon-upload"}},[e._v("导入")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"success",onclick:"alert('敬请期待')",icon:"el-icon-web-download"}},[e._v("导出")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){e.dialogCluesAdd=!0}}},[e._v("新增")])],1)],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55",prop:"c_id"}}),e._v(" "),i("el-table-column",{attrs:{prop:"c_id",label:"ID",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{prop:"theme",label:"主题"}}),e._v(" "),i("el-table-column",{attrs:{prop:"enterprise_name",label:"公司名称"}}),e._v(" "),i("el-table-column",{attrs:{label:"客户姓名"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("a",{attrs:{href:"javascript:;"},on:{click:function(i){e.openDetails(t.row.c_id)}}},[e._v(e._s(t.row.customer_name))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"telephone",label:"联系电话"}}),e._v(" "),i("el-table-column",{attrs:{label:"客户分类"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.getDicVals(t.row.classification,"classification"))+"\n                ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"购买意向"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.getDicVal(t.row.purchase_intention,"purchase_intention"))+"\n                ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"intentional_area",label:"意向面积"}}),e._v(" "),i("el-table-column",{attrs:{prop:"user_name",label:"业务员"}}),e._v(" "),i("el-table-column",{attrs:{prop:"created_time",label:"创建时间"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(i){e.cluesEdit(t.row.c_id)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"warning",plain:""},on:{click:function(i){e.FollowUp(t.row.c_id,t.row.customer_name,t.row.purchase_intention)}}},[e._v("跟进记录")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"success",plain:""},on:{click:function(i){e.cluesToChance(t.row.c_id)}}},[e._v("转机会客户")]),e._v(" "),i("el-button",{attrs:{size:"mini",plain:""},on:{click:function(i){e.cluesDemand(t.row.c_id)}}},[e._v("需求")])]}}])})],1),e._v(" "),i("div",{staticClass:"text-center m-t"},[e.dataTotal>10?i("el-pagination",{attrs:{"current-page":e.pageIndex,"page-sizes":[10,15,20,30],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.dataTotal},on:{"size-change":e.pageSizeChange,"current-change":e.pageIndexChange}}):e._e()],1)],1),e._v(" "),e.dialogCluesAdd?i("el-dialog",{attrs:{title:"新增线索客户",visible:e.dialogCluesAdd,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogCluesAdd=t}}},[i("CluesAdd",{on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogCluesEdit?i("el-dialog",{attrs:{title:"编辑线索客户",visible:e.dialogCluesEdit,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogCluesEdit=t}}},[i("CluesAdd",{attrs:{id:e.editId},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogFollowUp?i("el-dialog",{attrs:{title:"跟进记录",visible:e.dialogFollowUp,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogFollowUp=t}}},[i("FollowUp",{attrs:{followData:e.FollowUpObj},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogCluesToChance?i("el-dialog",{attrs:{title:"线索客户转机会客户",visible:e.dialogCluesToChance,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogCluesToChance=t}}},[i("CluesToChance",{attrs:{id:e.editId},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogChangeSalesman?i("el-dialog",{attrs:{title:"变更业务员",visible:e.dialogChangeSalesman,"append-to-body":"",width:"900px"},on:{"update:visible":function(t){e.dialogChangeSalesman=t}}},[i("ChangeSalesman",{attrs:{users:e.selectionChecked},on:{closeDialog:e.closeDialog,parentGetDataList:e.getDataList}})],1):e._e(),e._v(" "),e.dialogDetails?i("el-dialog",{attrs:{title:"客户详情",visible:e.dialogDetails,"append-to-body":"",width:"1000px"},on:{"update:visible":function(t){e.dialogDetails=t}}},[i("Details",{attrs:{id:e.editId},on:{closeDialog:e.closeDialog}})],1):e._e()],1)},staticRenderFns:[]};var v=i("Aizv")(h,g,!1,function(e){i("fkiy")},"data-v-2e9d8d3c",null);t.default=v.exports},fkiy:function(e,t){},quA1:function(e,t){}});
//# sourceMappingURL=10.11554d58c041d441e868.js.map